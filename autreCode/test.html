<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>سعر العملات حسب المنصة</title>
  <style>
    body { font-family: Arial; direction: rtl; text-align: center; padding: 20px; }
    select, table { margin: 10px; }
    #price-box { font-size: 24px; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>اختر منصة:</h2>
  <select id="exchange-select">
    <option value="">-- اختر منصة --</option>
    <option value="kucoin">KuCoin</option>
    <option value="binance">Binance</option>
    <option value="bybit">Bybit</option>
    <option value="gateio">Gate.io</option>
  </select>

  <div id="coin-container" style="display:none;">
    <h2>اختر عملة:</h2>
    <select id="coin-select"></select>
  </div>

  <div id="price-box"></div>

  <script>
    const functions = {
      kucoin: {
        symbols: "https://getpricekucoin-c7wyxtkrxq-uc.a.run.app/getSymbolsKucoin",
        price: "https://getpricekucoin-c7wyxtkrxq-uc.a.run.app/getPriceKucoin"
      },
      binance: {
        symbols: "https://getpricebinance-c7wyxtkrxq-uc.a.run.app/getSymbolsBinance",
        price: "https://getpricebinance-c7wyxtkrxq-uc.a.run.app/getPriceBinance"
      },
      bybit: {
        symbols: "https://getpricebybit-c7wyxtkrxq-uc.a.run.app/getSymbolsBybit",
        price: "https://getpricebybit-c7wyxtkrxq-uc.a.run.app/getPriceBybit"
      },
      gateio: {
        symbols: "https://getpricegateio-c7wyxtkrxq-uc.a.run.app/getSymbolsGateio",
        price: "https://getpricegateio-c7wyxtkrxq-uc.a.run.app/getPriceGateio"
      }
    };

    let currentInterval = null;

    document.getElementById("exchange-select").addEventListener("change", async function () {
      const exchange = this.value;
      clearInterval(currentInterval);
      document.getElementById("price-box").innerHTML = "";
      document.getElementById("coin-select").innerHTML = "";
      document.getElementById("coin-container").style.display = "none";

      if (!exchange) return;

      const url = functions[exchange].symbols;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const coinSelect = document.getElementById("coin-select");
        coinSelect.innerHTML = "";

        data.symbols.slice(0, 100).forEach(symbol => {
          const option = document.createElement("option");
          option.value = symbol;
          option.textContent = symbol;
          coinSelect.appendChild(option);
        });

        document.getElementById("coin-container").style.display = "block";
      } catch (err) {
        alert("خطأ في جلب العملات من المنصة");
      }
    });

    document.getElementById("coin-select").addEventListener("change", function () {
      const coin = this.value;
      const exchange = document.getElementById("exchange-select").value;
      if (!coin || !exchange) return;

      // إيقاف التحديث السابق
      clearInterval(currentInterval);

      const priceUrl = functions[exchange].price;

      const updatePrice = async () => {
        try {
          const res = await fetch(`${priceUrl}?symbol=${coin}`);
          const data = await res.json();
          document.getElementById("price-box").innerHTML = `السعر الحالي لـ <b>${coin}</b>: <span>${data.price}</span>`;
        } catch (err) {
          document.getElementById("price-box").innerHTML = "فشل في جلب السعر.";
        }
      };

      updatePrice(); // تحديث أول مرة
      currentInterval = setInterval(updatePrice, 5000); // تحديث كل 5 ثواني
    });
  </script>

</body>
</html>
