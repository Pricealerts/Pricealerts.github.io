<!-- <!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Price Alerts Login</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <div id="status-message">جاري التحميل...</div>

    <script type="module">
        // استيراد دوال Firebase الضرورية
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithCredential } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // إعدادات Firebase
       const firebaseConfig = {
	apiKey: "AIzaSyDIR4H7Jk3bJN_QZp-Cs4CbqpRmsKkUTxc",
	authDomain: "pricealert-31787.firebaseapp.com",
	databaseURL:
		"https://pricealert-31787-default-rtdb.europe-west1.firebasedatabase.app",
	projectId: "pricealert-31787",
	storageBucket: "pricealert-31787.firebasestorage.app",
	messagingSenderId: "200237716010",
	appId: "1:200237716010:web:65a9e33254d2302339a953",
	measurementId: "G-L693265WLN",
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 2. دالة التعامل مع استجابة Google One Tap
        window.handleCredentialResponse = (response) => {
            console.log("تم استلام التوكن من Google");
            
            // إنشاء اعتماد (Credential) لـ Firebase باستخدام التوكن القادم من Google
            const credential = GoogleAuthProvider.credential(response.credential);

            // تسجيل الدخول في Firebase
            signInWithCredential(auth, credential)
                .then((result) => {
                    console.log("تم تسجيل الدخول بنجاح في Firebase:", result.user);
                    document.getElementById('status-message').innerText = "مرحباً: " + result.user.displayName;
                    // هنا يمكنك توجيه المستخدم لصفحة أخرى
                })
                .catch((error) => {
                    console.error("خطأ في الربط مع Firebase:", error);
                });
        }

        // 3. تهيئة Google One Tap عند تحميل الصفحة
        window.onload = function () {
            google.accounts.id.initialize({
                // ضع هنا الـ Client ID الذي نسخته في الخطوة الأولى
                client_id: "200237716010-fsre2cg3a1dgm666mb1qcq6gdhntl2sd.apps.googleusercontent.com",
                callback: handleCredentialResponse, // الدالة التي سيتم استدعاؤها بعد اختيار الحساب
                auto_select: false, // اجعلها true إذا أردت الدخول التلقائي عند العودة
                cancel_on_tap_outside: false
            });

            // إظهار النافذة (كما في الصورة التي أرسلتها)
            google.accounts.id.prompt((notification) => {
                if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                    console.log("لم يتم عرض النافذة أو تم تخطيها");
                }
            });
        };
    </script>
</body>
</html>


 -->

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Price Alerts Login</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; }
        #buttonDiv { margin: 20px auto; width: fit-content; }
    </style>
</head>
<body>

    <h2>تسجيل الدخول</h2>
    
    <div id="buttonDiv"></div>

    <div id="status-message" style="margin-top: 20px; color: green;"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithCredential } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

         // إعدادات Firebase
       const firebaseConfig = {
	apiKey: "AIzaSyDIR4H7Jk3bJN_QZp-Cs4CbqpRmsKkUTxc",
	authDomain: "pricealert-31787.firebaseapp.com",
	databaseURL:
		"https://pricealert-31787-default-rtdb.europe-west1.firebasedatabase.app",
	projectId: "pricealert-31787",
	storageBucket: "pricealert-31787.firebasestorage.app",
	messagingSenderId: "200237716010",
	appId: "1:200237716010:web:65a9e33254d2302339a953",
	measurementId: "G-L693265WLN",
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // هذه الدالة ستعمل سواء ضغط المستخدم على الزر أو على النافذة المنبثقة
        window.handleCredentialResponse = (response) => {
            console.log("تم استلام التوكن...");
            
            // تحويل التوكن لبيانات يفهمها Firebase
            const credential = GoogleAuthProvider.credential(response.credential);

            signInWithCredential(auth, credential)
                .then((result) => {
                    document.getElementById('status-message').innerText = "تم تسجيل الدخول بنجاح: " + result.user.displayName;
                    // إخفاء الزر بعد النجاح (اختياري)
                    document.getElementById('buttonDiv').style.display = 'none';
                })
                .catch((error) => {
                    console.error("Error:", error);
                    document.getElementById('status-message').innerText = "حدث خطأ: " + error.message;
                    document.getElementById('status-message').style.color = "red";
                });
        }

        window.onload = function () {
            // 1. التهيئة (مشتركة للزر والنافذة)
            google.accounts.id.initialize({
                client_id: "200237716010-fsre2cg3a1dgm666mb1qcq6gdhntl2sd.apps.googleusercontent.com", // لا تنس تغيير هذا
                callback: handleCredentialResponse,
                auto_select: false,
                cancel_on_tap_outside: false
            });

            // 2. رسم الزر داخل الـ div
            google.accounts.id.renderButton(
                document.getElementById("buttonDiv"),
                { 
                    theme: "outline",  // الخيارات: "outline", "filled_blue", "filled_black"
                    size: "large",     // الخيارات: "large", "medium", "small"
                    text: "signin_with", // النص: "signin_with", "signup_with", "continue_with"
                    shape: "rectangular", // الشكل: "rectangular", "pill"
                    width: "250"       // عرض الزر بالبكسل
                } 
            );

            // 3. إظهار النافذة المنبثقة (One Tap) أيضاً
            google.accounts.id.prompt((notification) => {
                if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                    console.log("النافذة لم تظهر (ربما بسبب إغلاقها سابقاً أو إعدادات المتصفح)");
                }
            });
        };
        const tim = new Date().toISOString();
        console.log(tim);
        
    </script>
</body>
</html>