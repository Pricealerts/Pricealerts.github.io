<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ ููุณุจูู</title>
</head>
<body>

    <h2>ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ ููุณุจูู</h2>

    <button onclick="checkLoginState()">
        ุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ููุณุจูู
    </button>
    
    <div id="status" style="margin-top: 20px;"></div>

    <script>
        // โ๏ธ ุงูุฎุทูุฉ ุงูุฃููู: ุชููุฆุฉ SDK ูููุณุจูู
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '790787097326484', // โ๏ธ ุงุณุชุจุฏู ูุฐุง ุจูุนุฑู ุชุทุจููู
                cookie     : true,                     // ุชูููู ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ูุชุญุฏูุฏ ุงูุฌูุณุฉ
                xfbml      : true,                     // ุชูููู ุชุญููู ุนูุงูุงุช XFBML
                version    : 'v19.0'                  // ุงุณุชุฎุฏุงู ุฃุญุฏุซ ุฅุตุฏุงุฑ ูู Graph API
            });

            // ุงุฎุชูุงุฑู: ููููู ุงูุชุญูู ูู ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆููุง
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        };

        // ุชุญููู SDK ุจุดูู ุบูุฑ ูุชุฒุงูู
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));


        // 2. ุฏุงูุฉ ูุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู ุนุจุฑ Graph API
        function testAPI() {
            FB.api('/me', {fields: 'name,email,picture.type(large)'}, function(response) {
                
                // ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฅูููู ูุชุงุญุงู (ูุฏ ูุฑูุถู ุงููุณุชุฎุฏู ุฃู ูุง ูููู ูุฏูู ุฅูููู ุฃุณุงุณู)
                const userEmail = response.email ? response.email : "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ูุชุงุญ";
                
                // ุฌูุจ ุฑุงุจุท ุงูุตูุฑุฉ
                const userPicture = response.picture.data.url;

                console.log('ุจูุงูุงุช ุงููุณุชุฎุฏู:', response);
                
                // ุนุฑุถ ุงูุจูุงูุงุช ูู ุงูุตูุญุฉ
                const statusDiv = document.getElementById('status');
                statusDiv.innerHTML = '<h3>ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ!</h3>' +
                                      '<img src="' + userPicture + '" style="border-radius: 50%; width: 100px;">' +
                                      '<p><strong>ุงูุงุณู:</strong> ' + response.name + '</p>' +
                                      '<p><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> ' + userEmail + '</p>';
            });
        }


        // 3. ุฏุงูุฉ ุงูุชุญูู ูู ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู ุจุนุฏ ุงูุชูุงุนู ูุน ุงูุฒุฑ
        function statusChangeCallback(response) {
            if (response.status === 'connected') {
                // ุงููุณุชุฎุฏู ุณุฌู ุงูุฏุฎูู ููุงูู ุนูู ุงูุตูุงุญูุงุช
                document.getElementById('status').innerText = 'ูุชู ุฌูุจ ุงูุจูุงูุงุช...';
                testAPI();
            } else {
                // ุงููุณุชุฎุฏู ููุณ ูุณุฌูุงู ููุฏุฎูู ุฃู ูู ูููุญ ุงูุตูุงุญูุงุช
                document.getElementById('status').innerText = 'ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู.';
            }
        }


        // 4. ุงูุฏุงูุฉ ุงูุชู ูุชู ุงุณุชุฏุนุงุคูุง ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ
        function checkLoginState() {
            FB.login(function(response) {
                statusChangeCallback(response);
            }, {scope: 'public_profile,email'}); // ๐ ุทูุจ ุตูุงุญูุฉ ุงูุฅูููู
        }
    </script>
</body>
</html>
