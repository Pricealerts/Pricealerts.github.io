function updateUserData(e,t){const r=btoa(e.userEmail),n=ref(db,"allAcconts/"+r);t?get(n).then(e=>{if(e.exists()){const{lastLogin:t,paid:r,status:n,userPassword:s,...o}=e.val();for(const e in o)localStorage[e]=o[e]}else setData(n)}):setData(n)}function setData(e){set(e,{userEmail:user.email,lastLogin:(new Date).toISOString(),userName:user.userName,userEmail:user.userEmail,userPicture:user.photoURL,chtId1:"",chtId2:"",chtId3:"",status:"online"}).then(()=>{document.getElementById("msg").style.color="green",document.getElementById("msg").textContent="تم التسجيل وتعديل البيانات ✔️"}),console.log("الحساب غير موجود في قاعدة البيانات")}function sgnOUt(){signOut(auth).then(()=>{console.log("تم تسجيل الخروج بنجاح")}).catch(e=>{console.error("خطأ في تسجيل الخروج:",e)})}function parseJwt(e){var t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(r).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return console.log(n),JSON.parse(n)}function handleCredentialResponse(e){const t=parseJwt(e.credential);console.log("ID: "+t.sub),console.log("Full Name: "+t.name),console.log("Given Name: "+t.given_name),console.log("Family Name: "+t.family_name),console.log("Image URL: "+t.picture),console.log("Email: "+t.email),localStorage.UserName=t.name,localStorage.UserEmail=t.email,localStorage.UserPicture=t.picture,localStorage.UserId=t.sub}function sgnIn(e){try{signInWithEmailAndPassword(auth,userEmail,userPassword),updateUserData(user,isExst),saveImage(localStorage.userPicture),userPassword="",window.location.href=drction}catch(t){gebi(e).innerText="حدث خطأ أعد المحاولة ",gebi(e).style.color="red"}}async function adedUser(){if(gebi("codeCnfrm").value.length<6)return gebi("errmsgCnfrm").innerText="رمز التحقق خاطئ أعد المحاولة",gebi("errmsgCnfrm").style.color="red",!1;gebi("errmsgCnfrm").innerText="جاري التحقق ...",gebi("errmsgCnfrm").style.color="black";const e=new Date,t=e.getTime(),r={action:"addAccont",userId:t,userName:userName,userEmail:userEmail,userPassword:userPassword,userPicture:"/imgs/web/apple-touch-icon.png",inputCode:gebi("codeCnfrm").value,signUp:!0},n=await ftchFirebase(r);if("success"==n.status){const{userPassword:e,userId:t,inputCode:n,signUp:s,...o}=r;for(const e in o)localStorage[e]=o[e];sgnIn("errmsgCnfrm",!0)}}async function ftchFirebase(e){try{const t="https://europe-west1-pricealert-31787.cloudfunctions.net/proxyRequestV2/",r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await r.json(),s=JSON.parse(n);return console.log(s),s}catch(e){console.error("kayn error ftchFirebase 115 : "+e)}}import{signOut,auth,onAuthStateChanged,signInWithEmailAndPassword,signInWithCredential,GoogleAuthProvider,db,ref,update,set,get}from"https://pricealerts.github.io/firebaseCode.js";window.handleCredentialResponse=(e=>{console.log("تم استلام التوكن...");const t=GoogleAuthProvider.credential(e.credential);signInWithCredential(auth,t).then(e=>{updateUserData(e.user,!1),document.getElementById("buttonSignUp").style.display="none"}).catch(e=>{console.error("Error:",e)})}),window.onload=function(){google.accounts.id.initialize({client_id:"200237716010-fsre2cg3a1dgm666mb1qcq6gdhntl2sd.apps.googleusercontent.com",callback:handleCredentialResponse,auto_select:!1,cancel_on_tap_outside:!1}),google.accounts.id.renderButton(document.getElementById("buttonSignUp"),{theme:"outline",size:"large",text:"signin_with",shape:"rectangular",width:"250"}),google.accounts.id.renderButton(document.getElementById("buttonSignIn"),{theme:"outline",size:"large",text:"signin_with",shape:"rectangular",width:"250"}),google.accounts.id.prompt(e=>{(e.isNotDisplayed()||e.isSkippedMoment())&&console.log("النافذة لم تظهر (ربما بسبب إغلاقها سابقاً أو إعدادات المتصفح)")})},onAuthStateChanged(auth,e=>{e?console.log("User is signed in:",e):console.log("User is signed out")});export{auth};window.onload=function(){function e(e){google.accounts.id.renderButton(document.getElementById(e),{theme:"outline",size:"large"})}google.accounts.id.initialize({client_id:"200237716010-fsre2cg3a1dgm666mb1qcq6gdhntl2sd.apps.googleusercontent.com",callback:handleCredentialResponse}),e("buttonSignUp"),google.accounts.id.prompt()},setTimeout(()=>{console.log(document.querySelector("#buttonSignUp "))},1e3),gebi("btnSignIn").addEventListener("click",async e=>{e.preventDefault();const t=document.querySelectorAll("#frmSgnIn input");if(userEmail=t[0].value,userPassword=t[1].value,!userEmail.length||!userPassword.length)return gebi("errmsgsgnIn").innerText="عليك ملأ البيانات",gebi("errmsgsgnIn").style.color="red",!1;const r={action:"getAccont",userEmail:userEmail,userPassword:userPassword},n=await ftchFirebase(r);if("success"==n.status){const e=n.rslt;for(const t in e)localStorage[t]=e[t];sgnIn("errmsgsgnIn")}else"NoPassword"==n.status||"notexsist"==n.status?(gebi("errmsgsgnIn").innerText="  كلمة السر أو الإيميل خاطئ يرجى التأكد من الحساب",gebi("errmsgsgnIn").style.color="red"):console.log("rah flelse")}),gebi("btnCnfrmInEmail").addEventListener("click",async e=>{const t=document.querySelectorAll("#msgCnfrmInEmail input");userEmail=t[0].value,gebi("errmsgCnfrmInEmail").innerText="جاري الإرسال...",gebi("errmsgCnfrmInEmail").style.color="black";try{const e=await ftchFirebase({action:"sndMsgCnferIn",userEmail:userEmail});if("notexsist"==e.status)return gebi("errmsgCnfrmInEmail").innerText="هذا الحساب غير موجود",gebi("errmsgCnfrmInEmail").style.color="red",setTimeout(()=>{activateSignUp()},2e3),!1;if("notSend"==e.status)return gebi("errmsgCnfrmInEmail").innerText="الإيمل خاطئ تأكد منه وأعد المحاولة",gebi("errmsgCnfrmInEmail").style.color="red",!1;"success"==e.status&&(gebi("msgCnfrmIn").style.transform="translateY(0%)",gebi("errmsgCnfrmInEmail").innerText="")}catch(e){return console.log("err rspnsCnfrm"+e),!1}}),gebi("btnCnfrmIn").addEventListener("click",async e=>{gebi("errmsgCnfrmIn").innerText="جاري التحقق ...",gebi("errmsgCnfrmIn").style.color="black";try{const e=await ftchFirebase({action:"cnfrmCode",userEmail:userEmail,inputCode:gebi("codeCnfrmIn").value,signUp:!1});if("overNmber"==e.status)return gebi("errmsgCnfrmIn").innerText="لقد قمت بالمحاولة أكثر من 4 مرات  أعد المحاولة بعد ساعة",gebi("errmsgCnfrmIn").style.color="red",!1;if("notExist"==e.status)return gebi("errmsgCnfrmIn").innerText="رمز التحقق خاطئ أعد المحاولة",gebi("errmsgCnfrmIn").style.color="red",!1;if("exist"==e.status)return gebi("errmsgCnfrmIn").innerText="",gebi("newPswrd").style.transform="translateY(0%)",!1}catch(e){return console.log("error appscript : "+e),!1}}),gebi("btnNewPswrd").addEventListener("click",async e=>{gebi("errNewPswrd").innerText="جاري التحديث ...",gebi("errNewPswrd").style.color="black";try{const e=await ftchFirebase({action:"updtPsw",userEmail:userEmail,userPassword:gebi("inptNewPswrd").value});if("notExist"==e.status&&(gebi("errNewPswrd").innerText="إيميلك غير موجود أعد انشاء حساب من جديد",gebi("errNewPswrd").style.color="red",setTimeout(()=>{activateSignUp()},2e3)),"success"==e.status){const t=e.rslt;for(const e in t)localStorage[e]=t[e];sgnIn("errmsgsgnIn")}else gebi("errmsgsgnIn").innerText="حدث خطأ أعد المحاولة ",gebi("errmsgsgnIn").style.color="red",console.error(e.status)}catch(e){return console.log("error btnNewPswrd : "+e),!1}});const lstLoclSrorge=["action","userId","userName","userEmail","userPassword","userPicture","chtId1","chtId2","chtId3","paid","base64Pctr"];for(let e=0;e<lstLoclSrorge.length;e++){const t=lstLoclSrorge[e];localStorage.removeItem(t)}const drction="../accont/";gebi("btnSignUp").addEventListener("click",async()=>{const e=document.querySelectorAll("#frmSgnUp input");userName=e[0].value,userEmail=e[1].value,userPassword=e[2].value,gebi("errmsgsgnUp").innerText="جاري التسجيل ...",gebi("errmsgsgnUp").style.color="black";try{const e=await ftchFirebase({action:"sndMsgCnfer",userEmail:userEmail,userName:userName});if("exist"==e.status)return gebi("errmsgsgnUp").innerText="هذا الحساب موجود بالفعل قم بتسجيل الدخول",gebi("errmsgsgnUp").style.color="red",setTimeout(()=>{activateSignIn()},2e3),!1;"success"==e.status?gebi("msgCnfrm").style.transform="translateY(0%)":"notSend"==data.status?(gebi("errmsgsgnUp").innerText="الإيمل خاطئ تأكد منه وأعد المحاولة",gebi("errmsgsgnUp").style.color="red"):(gebi("errmsgsgnUp").innerText="حدث خطأ أعد المحاولة",gebi("errmsgsgnUp").style.color="red")}catch(e){return console.error("err rspnsCnfrm"+e),!1}}),gebi("btnCnfrm").addEventListener("click",async()=>{console.log("ddd"),await adedUser()});