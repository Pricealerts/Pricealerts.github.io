<!DOCTYPE html>
<html lang="ar">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Profile Card</title>

		<link
			rel="canonical"
			href="https://pricealerts.web.app/signin/index.html"
		/>
		<meta
			name="description"
			content="منصة Price Alerts لتنبيه أسعار العملات الرقمية والأسهم العالمية من عشر منصات تداول و 11 بورصة. تنبيهات فورية وسريعة."
		/>
		<meta
			name="keywords"
			content="تنبيه أسعار, عملات رقمية, أسهم, بورصة, تنبيهات سعر, تداول, Binance, KuCoin, nasdaq,nyse, OKX"
		/>
		<meta name="author" content="Price Alerts" />
		<meta name="robots" content="index, follow" />

		<!-- OG Meta for Social shares -->
		<meta
			property="og:title"
			content="Price Alerts - تنبيهات أسعار العملات الرقمية والأسهم"
		/>
		<meta
			property="og:description"
			content="تنبيهات سعرية فورية لـ 10 منصات تداول و 11 بورصة أسهم."
		/>
		<meta property="og:url" content="https://pricealerts.web.app/" />
		<meta property="og:type" content="website" />
		<meta
			property="og:image"
			content="https://pricealerts.web.app/imgs/web/apple-touch-icon.png"
		/>

		<title>حسابي</title>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>
		<link
			rel="stylesheet"
			href="https://pricealerts.github.io/style/navbar.css"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
			rel="stylesheet"
		/>

		<style>
			body {
				font-family: "Roboto", sans-serif; /* الخط المستخدم */
				background-color: #f0f2f5; /* لون الخلفية الفاتح */
				margin: 0;
				direction: rtl;
			}
			.navbar {
				padding: 20px;
			}

			.profile-container {
				display: flex;
				text-align: center; /* جعل النص في المنتصف */
				flex-direction: column;
				justify-content: center;
				align-items: center;
				margin: 40px;
				margin-top: 30px;
				padding: 20px;
			}

			/* تنسيق الاسم */
			.user-name {
				font-size: 28px; /* حجم الخط كبير */
				font-weight: 500; /* سمك الخط متوسط إلى عريض */
				color: #202124; /* لون أسود داكن (ليس أسود تماماً) */

				margin: 10px;
				padding: 10px;
				/* border: 1px solid #ccc;;
               border-radius: 5px; */
			}

			/* تنسيق البريد الإلكتروني */
			.user-email {
				font-size: 16px; /* حجم خط أصغر */
				color: #5f6368; /* لون رمادي */
				margin: 0;
				font-weight: 400; /* خط عادي غير عريض */
			}
			.chatIds {
				width: 70%;
				text-align: right;
				direction: rtl;
				font-size: 18px;
				margin: 20px;
			}
			.chatIds input {
				width: 90%;
				padding: 12px 15px;
				margin-bottom: 15px;
				border: 1px solid #ccc;
				border-radius: 6px;
				font-size: 1em;
				direction: rtl;
				text-align: right;
				transition: border-color 0.3s ease, box-shadow 0.3s ease;
			}
			.saveBtn {
				font-size: 20px;
				background: #007bff;
				border: none;
				border-radius: 5px;
				padding: 8px;
				color: white;
			}
		</style>
		<style>
			:root {
				--font-size: 10;
				--height-width-profile: 160;
				--border-radius-profile: 50;
				--height-img: 100;
			}
			/* تنسيق الصورة */
			.profile-photo {
				display: flex;
				width: calc(var(--height-width-profile) * 1px);
				height: calc(var(--height-width-profile) * 1px);
				border-radius: calc(var(--border-radius-profile) * 1%);
				object-fit: cover;
				overflow: hidden;
				background: linear-gradient(45deg, #1a3a6c, #4cc9f0);
				align-items: center;
				justify-content: center;
				color: white;
				font-size: calc(var(--font-size) * 7px);
				cursor: pointer;
				position: relative;
				margin-bottom: 10px;
			}
			.profile-photo img {
				height: calc(var(--height-img) * 1%);
			}
			.profile-photo:hover .imgCv {
				display: flex;
				flex-direction: column;
			}
			.imgCv {
				position: absolute;
				display: none;
				justify-content: center;
				align-items: center;
				border-radius: 50%;
				height: 100%;
				width: 100%;
				top: 0;
				left: 0;
				z-index: 3;
				cursor: pointer;
				background-color: #0000009e;
			}
			.imgCv img {
				height: 60px;
			}
			#errImg {
				color: red;
				display: none;
				font-size: calc(var(--font-size) * 2px);
				position: absolute;
				text-align: center;
			}
			.password-box {
				position: relative;
				width: 100%;
			}

			.password-box .eye {
				position: absolute;
				left: calc(10% - 12px);
				top: calc(50% - 9px);
				transform: translateY(-50%);
				cursor: pointer;
				font-size: 18px;
				user-select: none;
			}
			@media (max-width: 768px) {
				.profile-container {
					width: 100%;
					margin: 0;
					padding: 0;
				}
				.chatIds {
					width: 93%;
				}
				.password-box .eye {
					left: 15px;
				}
			}
		</style>
	</head>
	<body>
		<div id="pirantCntynr" class="pirantCntynr"></div>
		<div class="profile-container">
			<div class="profile-photo">
				<label for="input-file" id="drop-area">
					<input type="file" accept="image/*" id="input-file" hidden />
					<div class="imgCv">
						<img src="/imgs/camera-square-svgrepo-com.svg" alt="" />
					</div>
				</label>
				<div id="errImg">Error upload Image</div>
				<img
					id="uploadedImage"
					src="/imgs/user-svgrepo-com.svg"
					id="uploadedImage"
				/>
			</div>

			<h1 id="userName" class="user-name" contenteditable="true"></h1>

			<p id="uesrEmail" class="user-email"></p>

			<div class="chatIds">
				<!-- <label for="userPassword">كلمة السر</label>
				<br />

				<div class="password-box">
					<input id="userPassword" type="password" placeholder="كلمة السر" />
					<span class="eye" onclick="togglePwd(this,'userPassword')"
						><i class="fa-solid fa-eye"></i
					></span>
				</div> -->
				<br /><br />

				معرّفات دردشة التيليجرام (Chat ID) : الخاص بك
				<br /><br />
				<label for="telegramChatId1">Chat ID 1</label>
				<br />
				<input
					type="text"
					id="telegramChatId1"
					placeholder="أدخل معرّف دردشة تيليجرام"
				/>
				<br /><br />
				<label for="telegramChatId2">Chat ID 2</label>
				<br />
				<input
					type="text"
					id="telegramChatId2"
					placeholder="أدخل معرّف دردشة تيليجرام"
				/>
				<br /><br />
				<label for="telegramChatId3">Chat ID 3</label>
				<br />
				<input
					type="text"
					id="telegramChatId3"
					placeholder="أدخل معرّف دردشة تيليجرام"
				/>
			</div>
			<p id="rspns"></p>
			<button id="saveBtn" class="saveBtn">حفظ التغيرات</button>
		</div>

		<script src="https://pricealerts.github.io/js/navbar.js"></script>

		<!-- front and script -->
		<script>
			function gebi(el) {
				return document.getElementById(el);
			} //   https://drive.google.com/file/d/1jCfKYWrJP462N840a5juX-H8Uwj_HxCR/view
			//	UserImage
			window.addEventListener("load", async () => {
				await startpage();
			});
			//window.onload()

			async function startpage() {
				const userEmailCnt = localStorage.userEmail || "إيميلك";
				gebi("uploadedImage").src =
					UserImage || "/imgs/web/apple-touch-icon.png";
				gebi("userName").innerText = localStorage.userName || "إسمك";
				gebi("uesrEmail").innerHTML = userEmailCnt || "إيميلك";
				/* if (localStorage.userPassword) {
					gebi("userPassword").value = localStorage.userPassword;
					localStorage.removeItem("userPassword");
				} else {
					if (userEmailCnt == "إيميلك") {
						return false;
					}
					try {
						const urlFirebase =
							"https://europe-west1-pricealert-31787.cloudfunctions.net/proxyRequestV2";
						const response = await fetch(urlFirebase, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify({
								action: "forgetPswrd",
								userEmail: userEmailCnt,
							}),
						});
						const data = await response.json();
						const rspns = JSON.parse(data);
						if (rspns.status == "success") {
							gebi("userPassword").value = rspns.rslt.userPassword;
						}
					} catch (error) {
						console.error("kayn error :" + error);
					}
				} */

				gebi("telegramChatId1").value = localStorage.chtId1;
				gebi("telegramChatId2").value = localStorage.chtId2;
				gebi("telegramChatId3").value = localStorage.chtId3;
			}

			const inputFile = gebi("input-file");
			let imgCntnt;
			let file;
			inputFile.addEventListener("change", async e => {
				file = e.target.files[0];

				if (!file) {
					gebi("errImg").style.display = "block";
					return;
				}
				imgCntnt = URL.createObjectURL(file);
				gebi("uploadedImage").src = imgCntnt;
			});
		</script>
		<!-- btn save -->
		<script>
			const WEB_APP_URL =
				"https://script.google.com/macros/s/AKfycbzAoBdBnx3by3AwPW2H1zZQtGEVNiYux1DlVAj47Zz6hrTqORan378zeyDycwLXXZLJTA/exec"; // رابط apps script

			gebi("saveBtn").addEventListener("click", async e => {
				gebi("rspns").innerText = "جاري الحفظ ...";
				gebi("rspns").style.color = "black";

				/////////////////////////// jiht limage
				let imgSrc = localStorage.userPicture;

				if (gebi("userName").innerText.length < 2) {
					gebi("rspns").innerText = "  خانة الإسم فارغة عليك ملأها ";
					gebi("rspns").style.color = "red";
					setTimeout(() => {
						gebi("rspns").innerText = "";
					}, 15000);
					return false;
				}
				if (
					gebi("telegramChatId1").value.length == 0 &&
					gebi("telegramChatId2").value.length == 0 &&
					gebi("telegramChatId3").value.length == 0
				) {
					gebi("rspns").innerText = "  لم تسجل أي chat Id ";
					gebi("rspns").style.color = "red";
					setTimeout(() => {
						gebi("rspns").innerText = "";
					}, 15000);
					return false;
				}
				// 1 MB = 1,000,000 bytes (تقريبًا)
				const MAX_SIZE = 1 * 1024 * 1024; // أو 1_000_000
				if (file) {
					if (file.size > MAX_SIZE) {
						alert("حجم الصورة يجب أن يكون أقل من 1 MB");
						return;
					}
					// تحويل الصورة Base64
					const base64 = await toBase64(file);
					localStorage.base64Pctr = base64;
					const imgName = localStorage.userId || "dadi";
					// إرسال الصورة عبر fetch
					const response = await fetch(WEB_APP_URL, {
						method: "POST",
						// headers: { "Content-Type": "application/json" },
						body: JSON.stringify({
							action: "postImg",
							image: base64,
							name: imgName,
						}),
					});

					const result = await response.json();
					console.log(result);
					if (result.status != "success") {
						gebi("rspns").innerText = "حدث خطأ أعد المحاولة";
						gebi("rspns").style.color = "red";
						setTimeout(() => {
							gebi("rspns").innerText = "";
						}, 15000);
						return false;
					}
					imgSrc = `https://drive.google.com/thumbnail?id=${result.fileId}&sz=w800`;
					localStorage.userPicture = imgSrc;
				}
				const bodySet = {
					action: "upditAccont",
					userId: localStorage.userId,
					userName: gebi("userName").innerText,
					userEmail: gebi("userEmail").innerText,
					userPassword: gebi("userPassword").value,
					userPicture: imgSrc || "/imgs/web/apple-touch-icon.png",
					chtId1: gebi("telegramChatId1").value,
					chtId2: gebi("telegramChatId2").value,
					chtId3: gebi("telegramChatId3").value,
					paid: false,
				};

				for (const key in bodySet) {
					const element = bodySet[key];
					localStorage[key] = element;
				}
				saveImage(imgSrc);

				try {
					const url =
						"https://europe-west1-pricealert-31787.cloudfunctions.net/proxyRequestV2";
					const response = await fetch(url, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify(bodySet),
					});

					const data = await response.json();

					const rspns = JSON.parse(data);
					if (rspns.status == "success") {
						gebi("rspns").innerText = "تم التحديث بنجاح";
						gebi("rspns").style.color = "green";
						setTimeout(() => {
							gebi("rspns").innerText = "";
							window.location.href = "https://pricealerts.web.app";
						}, 3000);
						return false;
					} else {
					}
				} catch (error) {
					console.log("kayn error :" + error);
				}

				setTimeout(() => {
					gebi("rspns").innerText = "";
				}, 5000);

				gebi("rspns").innerText = "تم الحفظ بنجاح";
				gebi("rspns").style.color = "green";
			});

			function toBase64(file) {
				return new Promise((resolve, reject) => {
					const reader = new FileReader();
					reader.onload = () => resolve(reader.result.split(",")[1]);
					reader.onerror = reject;
					reader.readAsDataURL(file);
				});
			}
		</script>
		<!-- save image and togglePwd -->
		<script>
			function saveImage(source) {
				const img = document.getElementById("uploadedImage");
				img.src = source;

				// إنشاء canvas مؤقت
				const canvas = document.createElement("canvas");
				const ctx = canvas.getContext("2d");

				// ضبط حجم canvas على حجم الصورة
				canvas.width = img.width;
				canvas.height = img.height;

				// رسم الصورة على canvas
				ctx.drawImage(img, 0, 0, img.width, img.height);

				// استخراج Base64
				const base64 = canvas.toDataURL("image/png");

				// حفظ Base64 في localStorage
				localStorage.setItem("base64Pctr", base64);
				//return base64;

				//alert("تم تخزين الصورة في LocalStorage!");
			}

			function togglePwd(toggle, id) {
				const password = gebi(id);
				if (password.type === "password") {
					password.type = "text"; // إظهار

					toggle.innerHTML = '<i class="fa-solid fa-eye-slash"></i>';
				} else {
					password.type = "password"; // إخفاء
					toggle.innerHTML = '<i class="fa-solid fa-eye"></i>'; // إعادة الأيقونة
				}
			}
		</script>
	</body>
</html>
