<!DOCTYPE html>
<html lang="ar" dir="rtl">
	<head>
		<meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, minimum-scale=0.1">
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>صفحة مع شريط جانبي</title>

		
	</head>

	<body><input type="file" id="inputFile">
<img id="preview" width="200">

<div>
    <img id="reslt" src="" alt="">
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwbQ2g5Rq3A2g51oTqBKqAu3LdAXXqWQ-KTGnjct0gENexQYt-p_Z5Ec1V-_ytZ6JDF/exec";






document.getElementById("inputFile").addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // تحقق من الحجم < 1MB
    if (file.size > 1 * 1024 * 1024) {
        alert("حجم الصورة يجب أن يكون أقل من 1MB");
        return;
    }

    // عرض الصورة فورًا
    document.getElementById("preview").src = URL.createObjectURL(file);
try {
     // تحويل الصورة إلى Base64
    const base64 = await toBase64(file);

    // رفع الصورة عبر fetch
    const response = await fetch(WEB_APP_URL, {
        method: "POST",
       // headers: { "Content-Type": "application/json" },
        body: JSON.stringify({/* action:'postImg', */ image: base64, name: 'dd' })
    });

    const result = await response.json();
    
    console.log(result);
    
    if (result.status === "success") {
       /*  // بعد الرفع، جلب Blob من Web App
        const response2 = await fetch(WEB_APP_URL, {
        method: "POST",
        //headers: { "Content-Type": "application/json" },fileId
        body: JSON.stringify({action:'getImg',  fileId: result.fileId })
    });

const data = await response2.json();
 console.log(data); */
//document.getElementById("reslt").src = URL.createObjectURL(blob);
const urlImg =  `https://drive.google.com/thumbnail?id=${result.fileId}&sz=w800`;
document.getElementById("reslt").src = urlImg;





/* if(data.status === "success") {
    const imgSrc = `data:${data.mimeType};base64,${data.base64}`;
    console.log(imgSrc);
    
    document.getElementById("reslt").src = imgSrc;
} */


    } else {
        console.log("Error: " + result.message);
    }
} catch (error) {
    console.log(error);
    
}
   
});

function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}


const allUsers = {usr1:{email:'dadi',password: 'abdou'},usr2:{email:'ossama',password: 'souso'} }

for (const userId in allUsers) {
				console.log(allUsers[userId].email);
                
				/* if (allUsers[userId].email == data.email){
					if (allUsers[userId].password == data.password) {
						
						return {status : "success",rslt:allUsers[userId]}
					}else{
						return {status : "NoPassword",message : 'error Password'}
					}
					
				} */
				
			}
</script>


	</body>
</html>
