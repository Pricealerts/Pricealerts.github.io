<!DOCTYPE html>
<html lang="ar" dir="rtl">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, minimum-scale=0.1" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>صفحة مع شريط جانبي</title>
	</head>

	<body>
		<input type="file" id="inputFile" />
		<img id="preview" width="200" />

		<div>
			<img id="reslt" src="" alt="" />
		</div>

		<script>
			const WEB_APP_URL =
				"https://script.google.com/macros/s/AKfycbzAoBdBnx3by3AwPW2H1zZQtGEVNiYux1DlVAj47Zz6hrTqORan378zeyDycwLXXZLJTA/exec";

			document
				.getElementById("inputFile")
				.addEventListener("change", async e => {
					const file = e.target.files[0];
					if (!file) return;

					// تحقق من الحجم < 1MB
					if (file.size > 1 * 1024 * 1024) {
						alert("حجم الصورة يجب أن يكون أقل من 1MB");
						return;
					}

					// عرض الصورة فورًا
					document.getElementById("preview").src = URL.createObjectURL(file);
					try {
						// تحويل الصورة إلى Base64
						const base64 = await toBase64(file);

						// رفع الصورة عبر fetch
						const response = await fetch(WEB_APP_URL, {
							method: "POST",
							// headers: { "Content-Type": "application/json" },
							body: JSON.stringify({
								/* action:'postImg', */ image: base64,
								name: "dd",
							}),
						});

						const result = await response.json();

						console.log(result);

						if (result.status === "success") {
							const urlImg = `https://drive.google.com/thumbnail?id=${result.fileId}&sz=w8000`;
							document.getElementById("reslt").src = urlImg;
						} else {
							console.log("Error: " + result.message);
						}
					} catch (error) {
						console.log(error);
					}
				});

			function toBase64(file) {
				return new Promise((resolve, reject) => {
					const reader = new FileReader();
					reader.onload = () => resolve(reader.result.split(",")[1]);
					reader.onerror = reject;
					reader.readAsDataURL(file);
				});
			}

			const allUsers = {
				usr1: { email: "dadi", password: "abdou" },
				usr2: { email: "ossama", password: "laos" },
			};

			for (const userId in allUsers) {
				console.log(allUsers[userId].email);
			}

			const now = new Date().getTime(); 
			console.log(now);
			
		</script>
	</body>
</html>
