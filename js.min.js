async function loadUserAlertsDisplay(){try{const e=await dataAlrts(telegramChatId);let t=[];e&&(t=Object.entries(e)||[]);const r=alrtsStorg.filter(e=>"b"===e[1].alTp);alrtsStorg=[...r,...t],localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),renderAlerts()}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:",e),gebi("alertsList").innerHTML='<li class="no-alerts-message" style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.</li>'}}function renderAlerts(){alrtsStorg.forEach(([,e])=>{const{e:t,e2:r=t,s:a}=e;symbolsMap.has(a)||(symbolsMap.set(a,r),"binance"==!r&&(chkBrwsrY=!0),"binance"==r&&(chkBrwsrBnc=!0))});const e=alrtsStorg.filter(e=>"b"===e[1].alTp),t=alrtsStorg.filter(e=>"t"!==e[1].alTp);let r=gebi("alertsListNtf");r.innerHTML=e.length?"":'<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>',gebi("alertsList").innerHTML=t.length?"":'<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>',alrtsStorg.forEach(e=>{const{e:t,s:a,t:c,c:n,alTp:s="t"}=e[1];let o="g"===n?"Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ Ø§Ù„Ø³Ø¹Ø± Ø£ÙƒØ¨Ø± Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ":"Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ Ø§Ù„Ø³Ø¹Ø± Ø£ØµØºØ± Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ";const l=document.createElement("li");let i=`dltNtf(${e[0]})`,p="(Ø§Ù„Ù†ÙˆØ¹: ØªØ·Ø¨ÙŠÙ‚)";"t"===s&&(r=gebi("alertsList"),i=`deleteAlert(${JSON.stringify({alertId:e[0],telegramChatId:"cht"+telegramChatId})})`,p=`(Ø§Ù„Ù†ÙˆØ¹: ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…)\n\t\t\t\t<br>   Ø§Ù„Ù…Ø¹Ø±Ù:   \n\t\t\t\t ${telegramChatId}  `),l.id=e[0],l.innerHTML=`\n\t\t\t<span class="alert-info" >\n\t\t\t\t<strong>${EXCHANGES[t].name} - ${a}</strong>\n\t\t\t\t${o} ${c} \n\t\t\t\t${p}\n\t\t\t</span>\n\t\t\t<button class="delete-button" \n\t\t\tonclick = ${i}\n\t\t\t>Ø­Ø°Ù</button>\n\t\t`,r.appendChild(l)}),brwsrAlrtIntrvl(),chkBrwsrBnc&&bncWebSocketMult()}function brwsrAlrtIntrvl(){!chkBrwsrIntrvl&&chkBrwsrY&&(!chkBrwsrIntrvl||chkBrwsrY?chkBrwsrIntrvl=setInterval(()=>checkForBrowserAlerts(),3e5):clearInterval(chkBrwsrIntrvl))}async function checkForBrowserAlerts(){if(0===alrtsStorg.length)return;const e=Array.from(symbolsMap),t=e.map(async([e,t])=>"binanace"!=t&&fetchCurrentPrice(t,e,!1,!0).catch(r=>(console.error(`âŒ Error fetching ${t} from ${e} err is  :`),console.error(r),null))).filter(Boolean),r=await Promise.all(t),a=[];r.forEach((t,r)=>{const c=e[r][0];a.push(hndlAlrt(t,c))}),await Promise.all(a)}async function hndlAlrt(e,t){const r=alrtsStorg.filter(([,e])=>e.s===t),a=[];r.forEach(async t=>{const r=t[1],c=t[0];e*=r.f,("l"===r.c&&e<=r.t||"g"===r.c&&e>=r.t)&&("t"===r.alTp?a.push(deleteAlert({id:c,telegramChatId:"cht"+telegramChatId})):showBrowserNotification(r.s,e,r.t,r.c),await Promise.all(a),dltNtf(c))})}function dltNtf(e){gebi(e).remove(),alrtsStorg=alrtsStorg.filter(([t])=>t!==e),localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),alrtsStorg&&0!==alrtsStorg.length||(alertsListNtf.innerHTML='<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>')}function requestNotificationPermission(){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e?console.log("ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª."):(console.warn("Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª."),alertStatus.textContent="Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.",alertStatus.style.color="red")})}function showBrowserNotification(e,t,r,a){let c="l"===a?`Ø£ØµØ¨Ø­ â‰¥ ${r} USDT`:`Ø£ØµØ¨Ø­ â‰¤ ${r} USDT`;"granted"===Notification.permission?navigator.serviceWorker.ready.then(function(r){r.showNotification(`ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø¹Ø± ${e}!`,{body:`ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø± Ø¥Ù„Ù‰ ${t} USDT. ${c}`,icon:"../imgs/web/icon-512.png",vibrate:[200,100,200],tag:"price-alert"})}):requestNotificationPermission()}function gtRndmUrl(e){let t=[];for(let r=e.length;r>0;r--){const r=Math.floor(Math.random()*e.length);t.push(e[r]),e.splice(r,1)}return t}async function ftchFnctn(e,t=null){t||(frbUrl=frbsUrls[frbsUrls.indexOf(frbUrl)+1],frbUrl||(frbUrl=frbsUrls[0]),t=frbUrl),console.log(t);try{const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await r.json()}catch(e){throw console.error("Fetch error:",e),e}}async function ftchFnctnAPPs(e){apScUrl=orgnUrls[orgnUrls.indexOf(apScUrl)+1],apScUrl||(apScUrl=orgnUrls[0]);try{const t=await fetch(apScUrl,{method:"POST","Content-Type":"application",body:JSON.stringify(e)}),r=await t.json();return r}catch(e){throw console.error("Fetch error:",e),e}}async function smblsLclStrg(e,t,r,a=e){let c=100,n=localStorage.getItem(e);const s=Date.now();if(n){n=JSON.parse(n);const e=n.time;c=(s-e)/864e5}if(c<t)return n.symbols;{const t=await r(a),c={symbols:t,time:s};return localStorage[e]=JSON.stringify(c),t}}async function fetchTradingPairs(e){const t=EXCHANGES[e];if(!t)return currentPriceDisplay.textContent="Ù…Ù†ØµØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø©.",void(searchPrice.placeholder="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© ØµØ­ÙŠØ­Ø©");let r="none",a="none",c="none";"cryptocompare"==e&&(c="inline-block",allCrptCmpr.length||(allCrptCmpr.push({symbol:"USDT",factor:1}),allPricesBnc.forEach(e=>{if(e.symbol.includes("USDT")){const t=e.symbol.replace("USDT",""),r=1/e.price;allCrptCmpr.push({symbol:t,factor:r})}}),allCrptCmpr.sort((e,t)=>e.symbol.localeCompare(t.symbol)),cptoDsply.innerHTML=allCrptCmpr.map(e=>`<option value="${e.symbol}">${e.symbol}</option>`).join(""),cptoDsply.value="USDT")),exchs.includes(e)?r="inline-block":a="block",gebi("crptChos").style.display=a,gebi("noteYahoo").style.display=r,crncDsply.style.display=r,cptoDsply.style.display=c,factorPric=1;try{let r,a,c,n=[];switch(e){case"binance":localStorage.binance?allPricesBnc=JSON.parse(localStorage.binance):(r=await fetch(t.tickerPriceUrl),allPricesBnc=await r.json(),localStorage.binance=JSON.stringify(allPricesBnc)),n=allPricesBnc.map(e=>e.symbol),allSmblBnc=n;break;case"kucoin":c={action:"cryptoSymbols",url:t.exchangeInfoUrl},r=await smblsLclStrg(e,1,ftchFnctnAPPs,c),n=r,allPricesKucoin=n;break;case"coingecko":r=await fetch(t.exchangeInfoUrl),a=await r.json(),n=a.map(e=>e.id);break;case"okx":r=await fetch(t.tickerPriceUrl),allPricesOkx=await r.json(),allPricesOkx=allPricesOkx.data,console.log(allPricesOkx),n=allPricesOkx.map(e=>e.instId);break;case"bybit":r=await fetch(t.exchangeInfoUrl),a=await r.json(),allPrices=a.result.list,n=allPrices.map(e=>e.symbol);break;case"bitget":r=await fetch(t.tickerPriceUrl),a=await r.json(),allPrices=a.data,n=allPrices.map(e=>e.symbol);break;case"coincap":r=await fetch(t.tickerPriceUrl),a=await r.json(),n=a.data.filter(e=>e.symbol);break;case"coinmarketcap":r=await fetch(getPriceUrl,{method:"POST",body:JSON.stringify({action:"symbols"})}),a=await r.json(),n=a.smbls.map(e=>e.symbol);break;case"kraken":r=await fetch(t.exchangeInfoUrl),a=await r.json();let s=a.result,o=Object.entries(s);n=o.map(e=>e[0]);break;case"coinbase":r=await fetch(t.exchangeInfoUrl),a=await r.json(),n=a.filter(e=>!e.trading_disabled).map(e=>e.id);break;case"cryptocompare":r=await fetch(t.exchangeInfoUrl),a=await r.json(),n=Object.keys(a.Data);break;case"nasdaq":case"nyse":case"XSES":case"LSE":case"NSE":case"HKEX":case"SIX":case"XSWX":case"XPAR":case"XSHG":case"XPAR":case"XSHE":case"gateIoSmbls":n=await smblsLclStrg(e,30,gtDataStocks);break;case"other":n=otherPrpos;break;default:return console.warn(`Exchange info parsing not implemented for ${e}`),[]}if(dropdownList.innerHTML="",n.length>0){n.sort(),allCrpto=n;const t=n.splice(0,100);t.forEach(e=>{const t=createDiv(e);dropdownList.appendChild(t)}),searchPrice.value=t[0],"cryptocompare"==e&&(searchPrice.value="BTC"),setTimeout(()=>{startPriceUpdates(),n.forEach(e=>{const t=createDiv(e);dropdownList.appendChild(t)})},10)}else searchPrice.placeholder="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø²ÙˆØ§Ø¬  Ù…ØªØ§Ø­Ø©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© Ø£Ø®Ø±Ù‰",priceUpdateInterval&&clearInterval(priceUpdateInterval);rfrsh=0}catch(e){console.error(`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ù† ${t.name} : `,e),currentPriceDisplay.textContent="Ø®Ø·Ø£, Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„.",searchPrice.placeholder="Ø®Ø·Ø£, Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„",priceUpdateInterval&&clearInterval(priceUpdateInterval),console.log("3awd wla "+e),rfrsh++}}async function fetchCurrentPrice(e,t,r=!1,a=!1){const c=EXCHANGES[e];if(!c)return null;rfrsh++;try{let n,s,o,l="",i=null;switch(e){case"binance":if(r)i=bncWebSocket(t);else{if(!a)return null;{const e=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${t}`),r=await e.json();i=r.price}}break;case"kucoin":r?connectKuCoinWS(t):a&&(bdy={action:"gtPrice",url:c.exchangeInfoUrl,symbol:t},s=await smblsLclStrg(e,1,ftchFnctnAPPs,bdy),s.data.price&&(i=parseFloat(s.data.price)));break;case"coingecko":l=`${c.tickerPriceUrl}?ids=${t}&vs_currencies=usd`,n=await fetch(l).then(e=>e.json()),i=n[t].usd;break;case"okx":r&&connectOKX(t),i=allPrices.find(e=>e.instId==t).last;break;case"bybit":i=allPrices.find(e=>e.symbol==t).lastPrice,connectBybit(t);break;case"bitget":i=allPrices.find(e=>e.symbol==t).close;break;case"kraken":if(n=await fetch(`${c.tickerPriceUrl}?pair=${t}`),s=await n.json(),s.error&&s.error.length>0)console.error("Kraken API Error:",s.error);else{const e=Object.keys(s.result)[0];i=parseFloat(s.result[e].c[0])}break;case"coinbase":let p=`https://api.exchange.coinbase.com/products/${t}/ticker`;n=await fetch(p),s=await n.json(),i=s.price;break;case"cryptocompare":const h=c.gturl(t);if(n=await fetch(h),!n.ok)throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");s=await n.json(),i=s.USDT*factorPric;break;case"nasdaq":case"nyse":case"XSES":case"LSE":case"NSE":case"HKEX":case"SIX":case"XSWX":case"XPAR":case"XSHG":case"XPAR":case"XSHE":case"other":const d=Date.now();if(o=await ftchFnctn({action:"gtPr",smbl:t}),console.log(o),o.error&&rfrsh<3)return!1;o.symbol!=t&&(gebi("searchPrice").value=o.symbol),currencyFtch=o.currency,i=o.price,crncDsply.value=currencyFtch,crncDsply.value||(crncDsply.innerHTML+=`<option value="${currencyFtch}">${currencyFtch}</option>`,crncDsply.value=currencyFtch);const g=Date.now(),m=g-d;console.log(m);break;default:console.error("Ù…Ù†ØµØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±:",e)}if(null!==i){if(currentPrice=parseFloat(i),a)return currentPrice;currentPriceDisplay.textContent=`${currentPrice} `,r&&(targetPriceInput.value=currentPrice,document.querySelectorAll(".prcTrgt").forEach(e=>e.innerHTML=currentPrice))}rfrsh=0}catch(e){console.error(`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¹Ø± ${t} Ù…Ù† ${c.name}:`,e),currentPriceDisplay.textContent="Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±.",currentPrice=null,rfrsh<3&&console.log("3awd wla rfrsh : "+rfrsh)}}function startPriceUpdates(){priceUpdateInterval&&clearInterval(priceUpdateInterval),selectedSymbol=searchPrice.value,selectedSymbol&&currentExchangeId?(fetchCurrentPrice(currentExchangeId,selectedSymbol,!0),priceUpdateInterval=setInterval(()=>{console.log("priceUpdateInterval is : "+priceUpdateInterval),fetchCurrentPrice(currentExchangeId,selectedSymbol)},3e5)):(currentPriceDisplay.textContent="--.--",currentPrice=null)}async function startPage(){await fetchTradingPairs(currentExchangeId),requestNotificationPermission();const e=gebi("chtIdSlct")||"";telegramChatId=localStorage.getItem("idChat")||"";const t={ch1:localStorage.getItem("chtId1")||"",ch2:localStorage.getItem("chtId2")||"",ch3:localStorage.getItem("chtId3")||""},r=Object.values(t).filter(Boolean).map(e=>`<option value="${e}">${e}</option>`).join("");r.length?(e.style.display="block",e.innerHTML=r,telegramChatId=t.ch1||t.ch2||t.ch3,tlgChtIdInpt.value=telegramChatId,e.addEventListener("change",()=>{tlgChtIdInpt.value=e.value,telegramChatId=e.value}),gebi("alertsList").innerHTML='<li class="no-alerts-message">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>',tlgChtIdInpt.style.display="none"):telegramChatId.length?(tlgChtIdInpt.value=telegramChatId,gebi("alertsList").innerHTML='<li class="no-alerts-message">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>',setTimeout(()=>{loadUserAlertsDisplay()},12e4)):(tlgChtIdInpt.value="",gebi("telegramChatIdNote").style.display="block"),alrtsStorg.length&&renderAlerts(),alertTypeTelegramCheckbox.checked?telegramChatIdContainer.style.display="block":telegramChatIdContainer.style.display="none",exchangeSelect.addEventListener("change",()=>{currentPriceDisplay.textContent="--.--",currentExchangeId=exchangeSelect.value,searchPrice.value="",fetchTradingPairs(currentExchangeId),alertStatus.textContent=""}),searchPrice.addEventListener("change",()=>alertStatus.textContent=""),alertTypeTelegramCheckbox.addEventListener("change",()=>{alertTypeTelegramCheckbox.checked?telegramChatIdContainer.style.display="block":telegramChatIdContainer.style.display="none",alertStatus.textContent=""}),alertTypeBrowserCheckbox.addEventListener("change",()=>{alertTypeBrowserCheckbox.checked&&requestNotificationPermission(),alertStatus.textContent=""})}function gebi(e){return document.getElementById(e)}function showDropdown(){dropdownList.style.display="block"}function hideDropdown(){setTimeout(()=>{dropdownList.style.display="none"},200)}function populateList(e){dropdownList.innerHTML="",e.forEach(e=>{const t=createDiv(e);dropdownList.appendChild(t)})}async function filterList(){const e=searchPrice.value.tlc();if("other"!==exchangeSelect.value){let t=allCrpto.filter(t=>t.tlc().includes(e)).sort((t,r)=>t.tlc().indexOf(e)-r.tlc().indexOf(e));return populateList(t),!1}let t=e.trim();if(t.length<2)dropdownList.innerHTML="";else{t=encodeURIComponent(t);try{const e=await ftchFnctnAPPs({action:"smbls",smbl:t});dropdownList.innerHTML=e.map(e=>`<div class="suggestion-item" onclick = "gtPrcOfOther('${e.symbol}','${e.exchDisp}')"\n\t\t\t\t\t\t><strong>${e.symbol} </strong> â€” ${e.shortname||e.longname||"No Name"}<span\n\t\t\t\t\t\tstyle="color:gray">(${e.quoteType})</span><span style="color:gray">(${e.exchDisp})</span>\n                \t</div>`).join("")}catch(e){console.error("Search error:",e)}}}function createDiv(e){const t=document.createElement("div");return t.textContent=e,t.onclick=(()=>gtPrcOfOther(e)),t}function gtPrcOfOther(e,t=!1){othExch=t,searchPrice.value=e,currentPriceDisplay.textContent="--.--",dropdownList.style.display="none",startPriceUpdates()}function updateTargetPrice(){const e=targetPriceInput.value;e?document.querySelectorAll(".prcTrgt").forEach(t=>t.innerHTML=e):document.querySelectorAll(".prcTrgt").forEach(e=>e.innerHTML="0.00")}async function gtPrcCrncDsply(){let e=1,t=[];try{const r=currencyFtch+"USD=X";"USD"!==currencyFtch&&t.push(r);let a=1;const c=crncDsply.value,n=c+"USD=X";"USD"!==c&&t.push(n);const s=await ftchFnctn({action:"gtPr",smbl:t}),o={},l=[];if(s.forEach(e=>{if(e.error)return l.push(gtPrcCrncDsply());o[e.symbol]=e}),l.length)return Promise.all(l);console.log(s),"USD"!==currencyFtch&&(e=o[r].price||1),"USD"!==c&&(a=o[n].price||1),factorPric=e/a;const i=currentPrice*factorPric;currentPriceDisplay.textContent=i,targetPriceInput.value=i}catch(e){console.log(e)}}async function deleteAlert(e){console.log(e),await manageAlertOnFirebase("dltAlrt",{id:e.alertId,tId:e.telegramChatId})}async function manageAlertOnFirebase(e,t=null){let r={};const a=t.id;if(alertStatus.textContent=`Ø¬Ø§Ø±ÙŠ ${"setAlert"===e?"ØªØ¹ÙŠÙŠÙ†":"Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡...`,alertStatus.style.color="#007bff","t"===t.alTp||"dltAlrt"===e)try{await ftchFnctn({action:e,...t},FIREBASE_WEB_ALERT_URL).then(e=>{r=e})}catch(e){return alertStatus.textContent=`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª: ${e.message}`,alertStatus.style.color="red",console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨  firebase:",e),!1}else r.status="success";if("success"===r.status){if(alertStatus.textContent=`${"setAlert"===e?"ØªÙ… ØªØ¹ÙŠÙŠÙ†":"ØªÙ… Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ù†Ø¬Ø§Ø­.`,alertStatus.style.color="green","dltAlrt"===e)return dltNtf(a);if("setAlert"===e){const e=["id"+a,t];alrtsStorg.push(e)}return localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),renderAlerts(),t.isAlrd||"setAlert"!==e?(setTimeout(()=>{alertStatus.textContent="",t.isAlrd&&dltNtf(a)},3e3),!0):(await checkForBrowserAlerts(),setTimeout(()=>{alertStatus.textContent=""},3e3),!0)}return"notPaid"==r.status?(alertStatus.textContent="Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",alertStatus.style.color="red",!1):"notSuccess"==r.status?(alertStatus.textContent="ÙØ´Ù„ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø¹Ø±Ù‘Ù Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (Chat ID) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†Ù‡ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",alertStatus.style.color="red",console.log(r),!1):(alertStatus.textContent=`ÙØ´Ù„ ${"setAlert"===e?"ØªØ¹ÙŠÙŠÙ†":"Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: ${r.message||"Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ."}`,alertStatus.style.color="red",console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø©  firebase:",r),!1)}function hndlWebSocket(e){priceUpdateInterval&&clearInterval(priceUpdateInterval),exchSocket&&socketSmbl!=e&&(exchSocket.close(),exchSocket=null),socketSmbl=e}function errCnsl(e){exchSocket.onerror=(e=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:",e)}),exchSocket.onclose=(()=>{console.log("ğŸ”Œ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„")}),intervalWebSockt&&clearInterval(intervalWebSockt),intervalWebSockt=setInterval(()=>{exchSocket.readyState===WebSocket.OPEN&&exchSocket.send(e)},2e4)}function bncWebSocket(e){const t=e.toLowerCase();return hndlWebSocket(t),exchSocket=new WebSocket(`wss://stream.binance.com:9443/ws/${t}@ticker`),exchSocket.onmessage=(e=>{const t=JSON.parse(e.data);currentPrice=parseFloat(t.c),currentPriceDisplay.textContent=`${currentPrice} `}),allPricesBnc.find(t=>t.symbol==e).price}function bncWebSocketMult(){const e=Array.from(symbolsMap),t=e.map(([e,t])=>"binance"===t&&e.tlc()+"@ticker").filter(Boolean),r=t.length===scktSmblBnc.length&&t.every((e,t)=>e===scktSmblBnc[t]);if(!t.length||bncSckt&&r)return;bncSckt&&bncSckt.close(),scktSmblBnc=t,bncSckt=new WebSocket("wss://stream.binance.com:9443/ws"),bncSckt.onopen=(()=>{const e={method:"SUBSCRIBE",params:t,id:1};bncSckt.send(JSON.stringify(e))});let a=Date.now();bncSckt.onmessage=(e=>{const t=JSON.parse(e.data);if("24hrTicker"===t.e){const e=Date.now(),r=e-a;r>3e3&&(hndlAlrt(t.c,t.s),a=e)}})}async function connectKuCoinWS(e="0G-USDT"){hndlWebSocket(e);try{const t=await ftchFnctnAPPs({action:"kuCoinWS"}),{token:r,instanceServers:a}=t,c=a[0].endpoint;let n=Date.now();exchSocket=new WebSocket(`${c}?token=${r}&connectId=${n}`),exchSocket.onopen=(()=>{const t={id:Date.now(),type:"subscribe",topic:"/market/ticker:"+e,privateChannel:!1,response:!0};exchSocket.send(JSON.stringify(t))}),exchSocket.onmessage=(t=>{const r=JSON.parse(t.data);if("message"===r.type){currentPriceDisplay.textContent=`${r.data.size} `;const t=Date.now(),a=t-n;a>3e3&&(hndlAlrt(r.data.size,e),n=t)}}),errCnsl(JSON.stringify({id:Date.now(),type:"ping"}))}catch(e){console.error("âš ï¸ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù€ Token:",e)}}function connectOKX(e){hndlWebSocket(e);let t=Date.now();const r="wss://ws.okx.com:8443/ws/v5/public";exchSocket=new WebSocket(r),exchSocket.onopen=(()=>{const t={op:"subscribe",args:[{channel:"tickers",instId:e}]};exchSocket.send(JSON.stringify(t))}),exchSocket.onmessage=(r=>{const a=JSON.parse(r.data);if(a.data){const r=a.data[0].last;currentPriceDisplay.textContent=`${r} `;const c=Date.now(),n=c-t;n>3e3&&(hndlAlrt(r,e),t=c)}}),errCnsl("ping")}function connectBybit(e="BTCUSDT"){hndlWebSocket(e);let t=Date.now();const r="wss://stream.bybit.com/v5/public/linear";exchSocket=new WebSocket(r),exchSocket.onopen=(()=>{console.log("âœ… Ù…ØªØµÙ„ Ø¨Ù€ Bybit WebSocket");const t={op:"subscribe",args:["tickers."+e]};exchSocket.send(JSON.stringify(t))}),exchSocket.onmessage=(r=>{const a=JSON.parse(r.data);if(a.topic==="tickers."+e&&a.data){const r=a.data.lastPrice;if(r){currentPriceDisplay.textContent=`${r} `;const a=Date.now(),c=a-t;c>3e3&&(hndlAlrt(r,e),t=a)}}}),errCnsl(JSON.stringify({op:"ping"}))}let chkBrwsrIntrvl,chkBrwsrY,chkBrwsrBnc,orgnUrls=["https://script.google.com/macros/s/AKfycbzMgCAunXYJFMRFMQJX1UrQUnJdsjoHh31bZqumyi2-f6mgrJfbBwCwTNBR0YQUQD9ZSQ/exec"],frbsUrls=["https://rqststocks-wgqzo7cltq-ew.a.run.app"],frbUrl=frbsUrls[0];orgnUrls=gtRndmUrl(orgnUrls);let apScUrl=orgnUrls[0];console.log(frbUrl);const apiKyCrptcmpr="c60217b3b7ffab489c03f232284f717034db471ecdcbc25876c75bdef9756e0f",EXCHANGES={binance:{name:"Binance",exchangeInfoUrl:"https://api.binance.com/api/v3/exchangeInfo",tickerPriceUrl:"https://api.binance.com/api/v3/ticker/price",intervalData:1e7},mexc:{name:"MEXC",exchangeInfoUrl:"https://api.mexc.com/api/v3/ticker/price",tickerPriceUrl:"https://api.mexc.com/api/v3/ticker/price",intervalData:1e4},kucoin:{name:"KuCoin",exchangeInfoUrl:"https://api.kucoin.com/api/v1/symbols",tickerPriceUrl:"https://api.kucoin.com/api/v1/market/orderbook/level1",intervalData:1e4},coingecko:{name:"CoinGecko",exchangeInfoUrl:"https://api.coingecko.com/api/v3/coins/list",tickerPriceUrl:"https://api.coingecko.com/api/v3/simple/price",intervalData:1e4},okx:{name:"OKX",exchangeInfoUrl:"https://www.okx.com/api/v5/public/instruments?instType=SPOT",tickerPriceUrl:"https://www.okx.com/api/v5/market/tickers?instType=SPOT",intervalData:1e4},bybit:{name:"Bybit",exchangeInfoUrl:"https://api.bybit.com/v5/market/tickers?category=spot",tickerPriceUrl:"https://api.bybit.com/v2/public/tickers",intervalData:1e4},bitget:{name:"Bitget",exchangeInfoUrl:"https://api.bitget.com/api/spot/v1/public/products",tickerPriceUrl:"https://api.bitget.com/api/spot/v1/market/tickers",intervalData:1e4},lbank:{name:"LBank",exchangeInfoUrl:"https://api.lbkex.com/v2/ticker.do?symbol=all",tickerPriceUrl:"https://api.lbkex.com/v2/ticker.do?symbol=",intervalData:1e4},coincap:{name:"CoinCap",exchangeInfoUrl:"https://cors-anywhere.herokuapp.com/https://api.coincap.io/v2/assets",tickerPriceUrl:"https://api.coincap.io/v2/assets?symbol=bitcoin",intervalData:1e4},kraken:{name:"Kraken",exchangeInfoUrl:"https://api.kraken.com/0/public/AssetPairs",tickerPriceUrl:"https://api.kraken.com/0/public/Ticker",intervalData:1e4},coinbase:{name:"Coinbase",exchangeInfoUrl:"https://api.exchange.coinbase.com/products",tickerPriceUrl:"https://api.exchange.coinbase.com/products",intervalData:1e4},cryptocompare:{name:"Cryptocompare",exchangeInfoUrl:"https://min-api.cryptocompare.com/data/all/coinlist",tickerPriceUrl:"https://min-api.cryptocompare.com/data/price?fsym=",intervalData:1e4,gturl:e=>`https://min-api.cryptocompare.com/data/price?fsym=${e}&tsyms=USDT&api_key=c60217b3b7ffab489c03f232284f717034db471ecdcbc25876c75bdef9756e0f`},nasdaq:{name:"NASDAQ",exchangeInfoUrl:apScUrl,tickerPriceUrl:apScUrl,intervalData:36e5}},exchs=["HKEX","LSE","NSE","SIX","XSWX","XPAR","XSHG","XSHE","XSES","nyse","nasdaq","gateIoSmbls","other"];exchs.forEach(e=>{EXCHANGES[e]={...EXCHANGES.nasdaq},EXCHANGES[e].name=e});const otherPrpos=["BMW.DE","XAUT-USD","XAGX-USD","CL=F","SI=F","HG=F","PL=F","PA=F"];let getPriceUrl="https://script.google.com/macros/s/AKfycbyg0QZ6udY-A2E8r_Q5rwr46HKUgFxV2h1MvKW1xJtYBBx2OJAmQo5zBM_fYsGhjvU6/exec";const FIREBASE_WEB_ALERT_URL="https://europe-west1-pricealert-31787.cloudfunctions.net/proxyRequestV2";let allPrices,currencyFtch="USD",rfrsh=0,allSmblBnc=[],allPricesBnc=[],allPricesMexc=[],allPricesKucoin=[],allPricesOkx=[];const MAX_ALERTS=50,exchangeSelect=gebi("exchangeSelect"),currentPriceDisplay=gebi("currentPrice"),targetPriceInput=gebi("targetPrice"),searchPrice=gebi("searchPrice"),dropdownList=gebi("dropdownList"),crncDsply=gebi("crncDsply"),cptoDsply=gebi("cptoDsply"),alertTypeBrowserCheckbox=gebi("alertTypeBrowser"),alertTypeTelegramCheckbox=gebi("alertTypeTelegram"),telegramChatIdContainer=gebi("telegramChatIdContainer"),tlgChtIdInpt=gebi("telegramChatId"),alertStatus=gebi("alertStatus");let telegramChatId,priceUpdateInterval,deferredPrompt,currentExchangeId=exchangeSelect.value,selectedSymbol="",currentPrice=null,factorPric=1,allCrpto=[],allCrptCmpr=[],symbolsMap=new Map,alrtsStorg=JSON.parse(localStorage.getItem("alrtsStorg"))||[],othExch=!1;document.addEventListener("DOMContentLoaded",()=>{startPage()}),String.prototype.tlc=function(){return this.toLowerCase()},document.addEventListener("click",function(e){document.querySelector(".dropdown-container").contains(e.target)||hideDropdown()}),cptoDsply.addEventListener("change",()=>{const e=cptoDsply.value;factorPric=allCrptCmpr.find(t=>t.symbol==e).factor;let t=currentPrice*factorPric;e==searchPrice.value&&(t=1),currentPriceDisplay.textContent=t,targetPriceInput.value=t}),crncDsply.addEventListener("change",async()=>{await gtPrcCrncDsply()}),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,gebi("dvdw").style.display="block"});let buttonInstall=gebi("dvdw");buttonInstall.addEventListener("click",async()=>{gebi("dvdw").style.display="none",deferredPrompt.prompt(),deferredPrompt=null}),document.querySelectorAll(".crbtBtn").forEach(e=>{e.addEventListener("click",()=>{gebi("searchPrice").value=e.textContent,filterList()})});let UserImage=localStorage.base64Pctr||"/imgs/web/apple-touch-icon.png",accont="",enteEsc='<a  id="signOutLink" style="cursor:pointer" href="https://pricealerts.web.app/signin" >\n        \t\t\tØªØ³Ø¬Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„\n \t\t\t\t\t<img src="/imgs/web/signin-svgrepo-com.svg" alt="">\n\t\t\t\t</a> ';localStorage.base64Pctr&&(enteEsc="",accont=`<a id="accountLink" class="accountBtn" href="https://pricealerts.web.app/accont">\n\t\t\t\t${localStorage.userName||"Ø­Ø³Ø§Ø¨ÙŠ"}\n\t\t\t\t<img src="${UserImage}" alt="img" style="width: auto">\n\t\t\t </a>`);const sidebar=document.createElement("div");sidebar.className="sidebar",sidebar.innerHTML=`<!-- Sidebar (LEFT) -->\n\t\t\t<h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>\n\t\t\t<a href="https://pricealerts.web.app/">\n\t\t\t\tØ§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n\t\t\t\t<img src="/imgs/web/home-alt-1-svgrepo-com.svg" alt="home"></a>\n\t\t\t<a href="https://pricealerts.web.app/otherPage/about.html">\n\t\t\t\tÙ…Ù† Ù†Ø­Ù†\n            \t<img src="/imgs/web/info-circle-svgrepo-com.svg" alt="inf"></a>\n\n\t\t<!--\n        \t<a href="#">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>\n\t\t\t<a href="#">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a> \n             -->\n\t\t\t<a href="https://pricealerts.web.app/otherPage/privacy.html">\n           \t\tØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©\n\t\t\t\t<img src="/imgs/web/privacy-svgrepo-com.svg" alt=""></a>\n\t\t\t<a href="https://pricealerts.web.app/otherPage/contact.html">\n            Ø§ØªØµÙ„ Ø¨Ù†Ø§\n\t\t\t\t<img src="/imgs/web/mail-svgrepo-com.svg" alt="home"></a>\n\t\t\n        \t\t${enteEsc}\n\t\t\t\n\t\t\t${accont}\n`,document.body.prepend(sidebar);const navbar=document.createElement("nav");navbar.innerHTML=`\n\n<!-- Overlay -->\n\t\t<div id="overlay" class="overlay"></div>\n\n\t\t<!-- Navbar -->\n\t\t<div class="navbar">\n\t\t\t<a href="https://pricealerts.web.app" style= "height: 100%; display: flex; align-items: center;">\n\t\t\t\t<img id="imgNavbar" class="imgNavbar" src="${UserImage}" alt="">\n\t\t\t</a>\n\t\t\t<h1 class="hTitel">\n\t\t\t\tÙ…Ù†Ø¨Ù‡ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± \n\t\t\t</h1 >\n\t\t\t<div class="nav-title">\n                <button class="menu-btn" id="openSidebar">â˜°</button>\n\t\t\t</div>\n\t\t</div>\n\n\n`,document.querySelector(".pirantCntynr").prepend(navbar);const overlay=document.getElementById("overlay"),openBtn=document.getElementById("openSidebar");let exchSocket,socketSmbl,intervalWebSockt;openBtn.onclick=(()=>{sidebar.classList.add("open"),overlay.classList.add("show")}),overlay.onclick=(()=>{sidebar.classList.remove("open"),overlay.classList.remove("show")}),gebi("setAlertButton").addEventListener("click",async()=>{const e=alertTypeTelegramCheckbox.checked,t=alertTypeBrowserCheckbox.checked,r=currentPriceDisplay.textContent.trim();if(!e&&!t)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚).",void(alertStatus.style.color="red");selectedSymbol=searchPrice.value;let a=selectedSymbol;const c=parseFloat(targetPriceInput.value),n=document.querySelector('input[name="alertCondition"]:checked').value;if(telegramChatId=tlgChtIdInpt.value.trim(),isNaN(c)||c<=0)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ù…Ø³ØªÙ‡Ø¯Ù ØµØ­ÙŠØ­.",void(alertStatus.style.color="red");if(!a||!currentExchangeId||"NaN"==r)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© ÙˆØ¹Ù…Ù„Ø©.",void(alertStatus.style.color="red");if(e&&!telegramChatId)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù‘Ù Ø¯Ø±Ø¯Ø´Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….",void(alertStatus.style.color="red");const s={id:Date.now().toString(),e:currentExchangeId,s:a,t:c,c:n,f:factorPric,isAlrd:!1,prc:null};t&&(s.alTp="b"),othExch&&(s.e=othExch),"cryptocompare"==s.e&&(a+="USDT"),a=a.replace(/(_|-)/g,""),allSmblBnc.includes(a)&&"binance"!==s.e&&(s.e2="binance",s.s=a),e&&(localStorage.idChat&&localStorage.idChat===telegramChatId||(localStorage.setItem("idChat",telegramChatId),await loadUserAlertsDisplay(),gebi("telegramChatIdNote").style.display="none"),s.tId=telegramChatId,s.alTp="t",("l"===n&&r<=c||"g"===n&&r>=c)&&(s.isAlrd=!0,s.prc=r));const o=await manageAlertOnFirebase("setAlert",s);o&&(alertStatus.textContent+=(e?" ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…":"")+(t?" ØªØ·Ø¨ÙŠÙ‚ ":"")+`ØªÙ… ØªØ¹ÙŠÙŠÙ† ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù€ ${a}.`,alertStatus.style.color="green")});let bncSckt,scktSmblBnc=[];