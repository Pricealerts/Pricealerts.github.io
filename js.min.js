async function loadUserAlertsDisplay(){try{const e=await ftchFnctn(FIREBASE_WEB_ALERT_URL,{action:"gtAlerts",chid:telegramChatId}),t=Object.entries(e)||[],a=alrtsStorg.filter(e=>"b"===e[1].alTp);alrtsStorg=[...a,...t],localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),renderAlerts()}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:",e),gebi("alertsList").innerHTML='<li class="no-alerts-message" style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.</li>'}}function renderAlerts(){const e=alrtsStorg,t=e.filter(e=>"b"===e[1].alTp),a=e.filter(e=>"b"!==e[1].alTp);if(!e||0===e.length)return gebi("alertsListNtf").innerHTML='<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>',void(gebi("alertsList").innerHTML='<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>');gebi("alertsListNtf").innerHTML=0===t.length?'<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>':"",gebi("alertsList").innerHTML=0===a.length?'<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>':"";let r=gebi("alertsListNtf");e.forEach(e=>{console.log(e);const{e:t,s:a,t:c,c:n,alTp:s="t"}=e[1];let o="g"===n?"Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ Ø§Ù„Ø³Ø¹Ø± Ø£ÙƒØ¨Ø± Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ":"Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ Ø§Ù„Ø³Ø¹Ø± Ø£ØµØºØ± Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ";const l=document.createElement("li");let i=e[0],p="(Ø§Ù„Ù†ÙˆØ¹: ØªØ·Ø¨ÙŠÙ‚)",d="notif";"t"===s&&(r=gebi("alertsList"),i=JSON.stringify({alertId:i,telegramChatId:"cht"+telegramChatId}),p=`(Ø§Ù„Ù†ÙˆØ¹: ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…)\n\t\t\t\t<br>   Ø§Ù„Ù…Ø¹Ø±Ù:   \n\t\t\t\t ${telegramChatId}  `,d="button"),l.id=e[0],l.innerHTML=`\n\t\t\t<span class="alert-info" >\n\t\t\t\t<strong>${EXCHANGES[t].name} - ${a}</strong>\n\t\t\t\t${o} ${c} \n\t\t\t\t${p}\n\t\t\t</span>\n\t\t\t<button class="delete-${d}" \n\t\t\tdata-alert='${i}'\n\t\t\t>Ø­Ø°Ù</button>\n\t\t`,r.appendChild(l)}),document.querySelectorAll(".delete-button").forEach(e=>{e.addEventListener("click",e=>{const t=JSON.parse(e.target.dataset.alert);deleteAlert(t)})}),document.querySelectorAll(".delete-notif").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.alert;dltNtf(t)})})}function requestNotificationPermission(){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e?console.log("ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª."):(console.warn("Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª."),alertStatus.textContent="Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.",alertStatus.style.color="red")})}function showBrowserNotification(e,t,a,r){let c="l"===r?`Ø£ØµØ¨Ø­ â‰¥ ${a} USDT`:`Ø£ØµØ¨Ø­ â‰¤ ${a} USDT`;"granted"===Notification.permission?navigator.serviceWorker.ready.then(function(a){a.showNotification(`ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø¹Ø± ${e}!`,{body:`ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø± Ø¥Ù„Ù‰ ${t} USDT. ${c}`,icon:"../imgs/web/icon-512.png",vibrate:[200,100,200],tag:"price-alert"})}):requestNotificationPermission()}async function checkForBrowserAlerts(){if(0===alrtsStorg.length)return;let e=[...new Set(alrtsStorg.map(([,e])=>({e:e.e,s:e.s})))];const t=e.map(async e=>{try{const t=await fetchCurrentPrice(e.e,e.s,!1,!0);t&&await hndlAlrt(t,e.s)}catch(t){console.error(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¹Ø± ${e.s}:`,t)}});await Promise.all(t)}async function checkForBrowserAlerts2(){if(0===alrtsStorg.length)return;await hndlAlrt(currentPrice,selectedSymbol);let e=new Map;alrtsStorg.map(t=>(e.has(t[1].s)||e.set(t[1].s,t[1].e),t[1].id=t[0],t[1]));const t=e.map(async e=>{try{const t=await fetchCurrentPrice(e.e,e.s,!1,!0);t&&await hndlAlrt(t,e.s)}catch(t){console.error(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¹Ø± ${e.s}:`,t)}});await Promise.all(t)}async function hndlAlrt(e,t){const a=alrtsStorg.filter(([,e])=>e.s===t),r=[];a.forEach(async t=>{const a=t[1],c=t[0];("l"===a.c&&e<=a.t||"g"===a.c&&e>=a.t)&&("t"===a.alTp?r.push(await deleteAlert({id:c,telegramChatId:"cht"+telegramChatId})):showBrowserNotification(a.s,e,a.t,a.c),dltNtf(c))})}function dltNtf(e){gebi(e).remove(),alrtsStorg=alrtsStorg.filter(([t])=>t!==e),localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),alrtsStorg&&0!==alrtsStorg.length||(alertsListNtf.innerHTML='<li class="no-alerts-message">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</li>')}async function ftchFnctn(e,t){try{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){throw console.error("Fetch error:",e),e}}async function fetchTradingPairs(e){const t=EXCHANGES[e];if(gebi("crncDsply").style.display="none",!t)return currentPriceDisplay.textContent="Ù…Ù†ØµØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø©.",void(searchPrice.placeholder="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© ØµØ­ÙŠØ­Ø©");try{let a,r,c=[],n=getPriceUrl+"?action=getCryptoSymbols&urlSmbls="+t.exchangeInfoUrl;switch(gebi("crptChos").style.display=t.crptChos,gebi("crncDsply").style.display=t.crncDsply,gebi("noteYahoo").style.display=t.crncDsply,e){case"binance":a=await fetch(t.tickerPriceUrl),allPricesBns=await a.json(),c=allPricesBns.map(e=>e.symbol);break;case"mexc":a=await fetch(n),allPricesMexc=await a.json(),c=allPricesMexc.map(e=>e.symbol),gtDifrns();break;case"kucoin":a=await fetch(n),r=await a.json(),"200000"==r.code&&r.data?c=r.data.filter(e=>e.symbol.endsWith(t.usdtSuffix)&&e.enableTrading).map(e=>e.symbol):console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",r);break;case"coingecko":a=await fetch(t.exchangeInfoUrl),r=await a.json(),c=r.map(e=>e.id);break;case"okx":a=await fetch(t.tickerPriceUrl),allPrices=await a.json(),allPrices=allPrices.data,c=allPrices.map(e=>e.instId);break;case"bybit":a=await fetch(t.exchangeInfoUrl),r=await a.json(),allPrices=r.result.list,c=allPrices.map(e=>e.symbol);break;case"bitget":a=await fetch(t.tickerPriceUrl),r=await a.json(),allPrices=r.data,c=allPrices.map(e=>e.symbol);break;case"lbank":a=await fetch(n),r=await a.json(),allPrices=r.data,c=allPrices.map(e=>e.symbol);break;case"coincap":a=await fetch(t.tickerPriceUrl),r=await a.json(),c=r.data.filter(e=>e.symbol&&e.symbol.length<=10);break;case"coinmarketcap":a=await fetch(getPriceUrl,{method:"POST",body:JSON.stringify({action:"symbols"})}),r=await a.json(),c=r.smbls.map(e=>e.symbol);break;case"kraken":a=await fetch(t.exchangeInfoUrl),r=await a.json();let s=r.result,o=Object.entries(s);c=o.map(e=>e[0]);break;case"coinbase":a=await fetch(t.exchangeInfoUrl),r=await a.json(),c=r.filter(e=>!e.trading_disabled).map(e=>e.id);break;case"nasdaq":case"nyse":case"XSES":case"LSE":case"NSE":case"HKEX":case"SIX":case"XSWX":case"XPAR":case"XSHG":case"XPAR":case"XSHE":case"gateIoSmbls":let l=100,i=localStorage.getItem(e);const p=Date.now();if(i){i=JSON.parse(i);const e=i.time;l=Math.floor((p-e)/864e5)}if(l<30)c=i.symbols;else{r=await ftchFnctn(t.exchangeInfoUrl,{action:"stocksExchange",querySmble:e});const a={symbols:r,time:p};localStorage[e]=JSON.stringify(a),c=r}break;case"other":c=otherPrpos;break;default:return console.warn(`Exchange info parsing not implemented for ${e}`),[]}dropdownList.innerHTML="",c.length>0?(c.sort(),allCrpto=c,c.forEach(e=>{const t=createDiv(e);dropdownList.appendChild(t)}),searchPrice.value=c[0],setTimeout(()=>{startPriceUpdates()},10)):(searchPrice.placeholder="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø²ÙˆØ§Ø¬  Ù…ØªØ§Ø­Ø©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© Ø£Ø®Ø±Ù‰",priceUpdateInterval&&clearInterval(priceUpdateInterval)),rfrsh=0}catch(a){console.error(`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ù† ${t.name} : `,a),currentPriceDisplay.textContent="Ø®Ø·Ø£, Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„.",searchPrice.placeholder="Ø®Ø·Ø£, Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„",priceUpdateInterval&&clearInterval(priceUpdateInterval),console.log("3awd wla "+a),rfrsh++,rfrsh<3&&fetchTradingPairs(e)}}async function fetchCurrentPrice(e,t,a=!1,r=!1){const c=EXCHANGES[e];if(!c)return null;try{let n,s,o,l=getPriceUrl+"?action=getPrice&urlSmbl="+c.tickerPriceUrl,i="",p=null;switch(e){case"binance":if(a){binanceSocket&&binanceSocketSmbl!=t&&(binanceSocket.close(),binanceSocket=null),p=allPricesBns.find(e=>e.symbol==t).price;const e=t.toLowerCase();binanceSocket=new WebSocket(`wss://stream.binance.com:9443/ws/${e}@ticker`),binanceSocketSmbl=t,binanceSocket.onmessage=(e=>{const a=JSON.parse(e.data);currentPrice=parseFloat(a.c),currentPriceDisplay.textContent=`${currentPrice} `,hndlAlrt(currentPrice,t)})}else{if(!r)return await checkForBrowserAlerts(),null;{const e=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${t}`),a=await e.json();p=a.price,console.log("data is : "+p)}}break;case"mexc":if(a){mexcSocket&&mexcSocketSmbl!=t&&(mexcSocket.close(),mexcSocket=null),p=allPricesMexc.find(e=>e.symbol==t).price;let e=t.replace(/[-_ ]/g,"");mexcSocketSmbl=e;const a=e.toUpperCase();mexcSocket=new WebSocket("wss://wbs.mexc.com/ws"),mexcSocket.onopen=(()=>{console.log("rah hal");const e={method:"SUBSCRIPTION",params:[`spot@public.deals.v3.api@${a}`]};mexcSocket.send(JSON.stringify(e));let t=setInterval(()=>{mexcSocket.readyState===WebSocket.OPEN?mexcSocket.send(JSON.stringify({method:"PING"})):clearInterval(t)},3e4)}),mexcSocket.onmessage=(e=>{const a=JSON.parse(e.data);a.d&&a.d.deals&&a.d.deals.length>0&&(currentPrice=parseFloat(a.d.deals[0].p),currentPriceDisplay.textContent=`${currentPrice} `,console.log("currentPrice is : "+currentPrice),hndlAlrt(currentPrice,t))})}else{if(!r)return await checkForBrowserAlerts(),null;{const e=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${t}`),a=await e.json();p=a.price}}break;case"kucoin":i=`${l}&symbole=${t}`,n=await fetch(i),s=await n.json(),"200000"===s.code&&s.data&&s.data.price?(p=parseFloat(s.data.price),rfrsh=0):(console.error("Ø®Ø·Ø£ Ù…Ù† KuCoin API (ticker):",s.msg||JSON.stringify(s)),rfrsh++,rfrsh<5&&fetchTradingPairs(e));break;case"coingecko":i=`${c.tickerPriceUrl}?ids=${t}&vs_currencies=usd`,n=await fetch(i).then(e=>e.json()),p=n[t].usd;break;case"okx":p=allPrices.find(e=>e.instId==t).last;break;case"bybit":p=allPrices.find(e=>e.symbol==t).lastPrice;break;case"bitget":p=allPrices.find(e=>e.symbol==t).close;break;case"lbank":p=await allPrices.find(e=>e.symbol==t).ticker.latest;break;case"kraken":if(n=await fetch(`${c.tickerPriceUrl}?pair=${t}`),s=await n.json(),s.error&&s.error.length>0)console.error("Kraken API Error:",s.error);else{const e=Object.keys(s.result)[0];p=parseFloat(s.result[e].c[0])}break;case"coinbase":let d=`https://api.exchange.coinbase.com/products/${t}/ticker`;n=await fetch(d),s=await n.json(),p=s.price;break;case"nasdaq":case"nyse":case"XSES":case"LSE":case"NSE":case"HKEX":case"SIX":case"XSWX":case"XPAR":case"XSHG":case"XPAR":case"XSHE":case"other":o=await ftchFnctn(c.exchangeInfoUrl,{action:"price",querySmble:t}),o.symbol!=t&&(gebi("searchPrice").value=o.symbol),currencyFtch=o.currency,p=o.close,crncDsply.value=currencyFtch,crncDsply.value||(crncDsply.innerHTML+=`<option value="${currencyFtch}">${currencyFtch}</option>`,crncDsply.value=currencyFtch);break;default:console.error("Ù…Ù†ØµØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±:",e)}if(rfrsh=0,null!==p){if(r)return parseFloat(p);currentPrice=parseFloat(p),currentPriceDisplay.textContent=`${currentPrice} `,a&&(targetPriceInput.value=currentPrice,document.querySelectorAll(".prcTrgt").forEach(e=>e.innerHTML=currentPrice)),await checkForBrowserAlerts()}}catch(r){console.error(`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø³Ø¹Ø± ${t} Ù…Ù† ${c.name}:`,r),currentPriceDisplay.textContent="Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±.",currentPrice=null,rfrsh++,rfrsh<3&&(console.log("3awd wla rfrsh : "+rfrsh),fetchCurrentPrice(e,t,a))}}function startPriceUpdates(){if(priceUpdateInterval&&clearInterval(priceUpdateInterval),selectedSymbol=searchPrice.value,selectedSymbol&&currentExchangeId){if(binanceSocket&&binanceSocketSmbl===selectedSymbol)return;fetchCurrentPrice(currentExchangeId,selectedSymbol,!0),priceUpdateInterval=setInterval(()=>fetchCurrentPrice(currentExchangeId,selectedSymbol),EXCHANGES[currentExchangeId].intervalData)}else currentPriceDisplay.textContent="--.--",currentPrice=null}function dadiZin(){const e=new WebSocket("wss://wbs.mexc.com/ws");e.onopen=(()=>{console.log("âœ… Connected to MEXC WebSocket");const t={method:"SUBSCRIPTION",params:["spot@public.ticker.v3.api@BTCUSDT"],id:1};e.send(JSON.stringify(t))}),e.onmessage=(e=>{const t=JSON.parse(e.data);if(t&&t.data){const e=t.data;console.log("ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:",e.lastPrice)}}),e.onerror=(e=>{console.error("âŒ WebSocket Error:",e)}),e.onclose=(()=>{console.log("ğŸ”Œ Connection closed")})}function startMexcMultiTracking(e){const t=new WebSocket("wss://wbs.mexc.com/ws");t.onopen=(()=>{const a=e.map(e=>`spot@public.deals.v3.api@${e.toUpperCase()}`),r={method:"SUBSCRIPTION",params:a};t.send(JSON.stringify(r)),console.log(JSON.stringify(r))}),t.onmessage=(e=>{const t=JSON.parse(e.data);if(t.s&&t.d&&t.d.deals){const e=t.s,a=parseFloat(t.d.deals[0].p);console.log(`ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø±: ${e} -> ${a}`)}})}async function startPage(){await fetchTradingPairs(currentExchangeId),requestNotificationPermission(),localStorage.getItem("exchangeChoz")&&(exchangeSelect.value=localStorage.getItem("exchangeChoz"));const e=gebi("chtIdSlct")||"";telegramChatId=localStorage.getItem("idChat")||"";const t={ch1:localStorage.getItem("chtId1")||"",ch2:localStorage.getItem("chtId2")||"",ch3:localStorage.getItem("chtId3")||""},a=Object.values(t).filter(Boolean).map(e=>`<option value="${e}">${e}</option>`).join("");a.length>0?(e.style.display="block",e.innerHTML=a,telegramChatId=t.ch1||t.ch2||t.ch3,tlgChtIdInpt.value=telegramChatId,e.addEventListener("change",()=>{tlgChtIdInpt.value=e.value,telegramChatId=e.value}),gebi("alertsList").innerHTML='<li class="no-alerts-message">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>',tlgChtIdInpt.style.display="none",await loadUserAlertsDisplay()):telegramChatId.length>0?(tlgChtIdInpt.value=telegramChatId,gebi("alertsList").innerHTML='<li class="no-alerts-message">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>',await loadUserAlertsDisplay()):(tlgChtIdInpt.value="",alrtsStorg.length>0&&renderAlerts(),gebi("telegramChatIdNote").style.display="block"),alertTypeTelegramCheckbox.checked?telegramChatIdContainer.style.display="block":telegramChatIdContainer.style.display="none",exchangeSelect.addEventListener("change",()=>{currentPriceDisplay.textContent="--.--",currentExchangeId=exchangeSelect.value,searchPrice.value="",fetchTradingPairs(currentExchangeId),alertStatus.textContent=""}),searchPrice.addEventListener("change",()=>alertStatus.textContent=""),alertTypeTelegramCheckbox.addEventListener("change",()=>{alertTypeTelegramCheckbox.checked?telegramChatIdContainer.style.display="block":telegramChatIdContainer.style.display="none",alertStatus.textContent=""}),alertTypeBrowserCheckbox.addEventListener("change",()=>{alertTypeBrowserCheckbox.checked&&requestNotificationPermission(),alertStatus.textContent=""})}function gebi(e){return document.getElementById(e)}function showDropdown(){dropdownList.style.display="block"}function hideDropdown(){setTimeout(()=>{dropdownList.style.display="none"},200)}function populateList(e){dropdownList.innerHTML="",e.forEach(e=>{const t=createDiv(e);dropdownList.appendChild(t)})}async function filterList(){const e=searchPrice.value.toLowerCase();if("other"!==exchangeSelect.value){const t=allCrpto.filter(t=>t.toLowerCase().includes(e));populateList(t)}else{let t=e.trim();if(t.length<2)return void(dropdownList.innerHTML="");t=encodeURIComponent(t);const a=EXCHANGES.other.exchangeInfoUrl;try{const e=await ftchFnctn(a,{querySmble:t,action:"smbls"});dropdownList.innerHTML=e.map(e=>`\n                <div class="suggestion-item" onclick = "gtPrcOfOther('${e.symbol}')">\n                    <strong>${e.symbol}</strong> â€” ${e.shortname||e.longname||"No Name"}  \n                    <span style="color:gray">(\n\t\t\t\t\t${e.quoteType}\n\t\t\t\t\t)</span> <span style="color:gray">(${e.exchDisp})</span>\n                </div>\n            `).join("")}catch(e){console.error("Search error:",e)}}}function createDiv(e){const t=document.createElement("div");return t.textContent=e,t.onclick=(()=>gtPrcOfOther(e)),t}function gtPrcOfOther(e){searchPrice.value=e,currentPriceDisplay.textContent="--.--",dropdownList.style.display="none",startPriceUpdates()}function updateTargetPrice(){const e=targetPriceInput.value;e?document.querySelectorAll(".prcTrgt").forEach(t=>t.innerHTML=e):document.querySelectorAll(".prcTrgt").forEach(e=>e.innerHTML="0.00")}async function deleteAlert(e){await manageAlertOnFirebase("dltAlrt",{id:e.alertId,tId:e.telegramChatId})}async function manageAlertOnFirebase(e,t=null){let a={};const r=t.id;if(alertStatus.textContent=`Ø¬Ø§Ø±ÙŠ ${"setAlert"===e?"ØªØ¹ÙŠÙŠÙ†":"Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡...`,alertStatus.style.color="#007bff","t"===t.alTp||"dltAlrt"===e)try{await ftchFnctn(FIREBASE_WEB_ALERT_URL,{action:e,...t}).then(e=>{a=e})}catch(e){return alertStatus.textContent=`Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª: ${e.message}`,alertStatus.style.color="red",console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨  firebase:",e),!1}else a.status="success";if("success"===a.status){if(alertStatus.textContent=`${"setAlert"===e?"ØªÙ… ØªØ¹ÙŠÙŠÙ†":"ØªÙ… Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ù†Ø¬Ø§Ø­.`,alertStatus.style.color="green","dltAlrt"===e)return dltNtf(r);{const e={id:r,e:t.e,s:t.s,tId:t.tId||null,t:t.tPrc,c:t.c,alTp:t.alTp,f:t.f,isAlrd:t.isAlrd,prc:t.prc},a=["id"+r,e];alrtsStorg.push(a)}return localStorage.setItem("alrtsStorg",JSON.stringify(alrtsStorg)),renderAlerts(),t.isAlrd||"setAlert"!==e?(setTimeout(()=>{alertStatus.textContent="",t.isAlrd&&dltNtf(r)},3e3),!0):(await checkForBrowserAlerts(),setTimeout(()=>{alertStatus.textContent=""},3e3),!0)}return"notPaid"==a.status?(alertStatus.textContent="Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",alertStatus.style.color="red",!1):"notSuccess"==a.status?(alertStatus.textContent="ÙØ´Ù„ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø¹Ø±Ù‘Ù Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (Chat ID) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†Ù‡ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",alertStatus.style.color="red",console.log(a),!1):(alertStatus.textContent=`ÙØ´Ù„ ${"setAlert"===e?"ØªØ¹ÙŠÙŠÙ†":"Ø­Ø°Ù"} Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: ${a.message||"Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ."}`,alertStatus.style.color="red",console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¬Ø§Ø¨Ø©  firebase:",a),!1)}function startGateTracking(e=["BTC_USDT","ETH_USDT"]){gateSocket&&gateSocket.close(),gateSocket=new WebSocket("wss://api.gateio.ws/ws/v4/"),gateSocket.onopen=(()=>{const t={time:Math.floor(Date.now()/1e3),channel:"spot.tickers",event:"subscribe",payload:e.map(e=>e.toUpperCase())};gateSocket.send(JSON.stringify(t)),setInterval(()=>{gateSocket.readyState===WebSocket.OPEN&&gateSocket.send(JSON.stringify({method:"ping"}))},2e4)}),gateSocket.onmessage=(e=>{const t=JSON.parse(e.data);if("update"===t.event&&"spot.tickers"===t.channel){const e=t.result,a=e.currency_pair,r=parseFloat(e.last);console.log(`ğŸš€ Gate.io [${a}]: ${r}`)}}),gateSocket.onclose=(()=>{console.log("âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Gate.ioØŒ Ø³ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù..."),setTimeout(()=>startGateTracking(e),5e3)}),gateSocket.onerror=(e=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Gate:",e)})}async function getAllGatePrices(){try{const e=await fetch("https://api.gateio.ws/api/v4/spot/tickers"),t=await e.json();console.log(t)}catch(e){console.error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e)}}function gtDifrns(){const e=allPricesBns.map(e=>e.symbol).map(e=>e.replace(/(_|USDT|USDC|BTC)/g,"")),t=allPricesMexc.map(e=>e.symbol).map(e=>e.replace(/(_|USDT|USDC|BTC)/g,"")),a=JSON.parse(localStorage.getItem("gateIoSmbls")),r=a.symbols.map(e=>e.replace(/(_|USDT|USDC|BTC)/g,""));console.log(r);const c=t.filter(t=>!e.includes(t)),n=c.filter(e=>!r.includes(e)),s=[...new Set(n)];console.log(s)}const EXCHANGES={binance:{name:"Binance",exchangeInfoUrl:"https://api.binance.com/api/v3/exchangeInfo",tickerPriceUrl:"https://api.binance.com/api/v3/ticker/price",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},mexc:{name:"MEXC",exchangeInfoUrl:"https://api.mexc.com/api/v3/ticker/price",tickerPriceUrl:"https://api.mexc.com/api/v3/ticker/price",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},kucoin:{name:"KuCoin",exchangeInfoUrl:"https://api.kucoin.com/api/v1/symbols",tickerPriceUrl:"https://api.kucoin.com/api/v1/market/orderbook/level1",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},coingecko:{name:"CoinGecko",exchangeInfoUrl:"https://api.coingecko.com/api/v3/coins/list",tickerPriceUrl:"https://api.coingecko.com/api/v3/simple/price",usdtSuffix:"USD",intervalData:1e4,crptChos:"block",crncDsply:"none"},okx:{name:"OKX",exchangeInfoUrl:"https://www.okx.com/api/v5/public/instruments?instType=SPOT",tickerPriceUrl:"https://www.okx.com/api/v5/market/tickers?instType=SPOT",usdtSuffix:"-USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},bybit:{name:"Bybit",exchangeInfoUrl:"https://api.bybit.com/v5/market/tickers?category=spot",tickerPriceUrl:"https://api.bybit.com/v2/public/tickers",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},bitget:{name:"Bitget",exchangeInfoUrl:"https://api.bitget.com/api/spot/v1/public/products",tickerPriceUrl:"https://api.bitget.com/api/spot/v1/market/tickers",usdtSuffix:"USDT_SPBL",intervalData:1e4,crptChos:"block",crncDsply:"none"},lbank:{name:"LBank",exchangeInfoUrl:"https://api.lbkex.com/v2/ticker.do?symbol=all",tickerPriceUrl:"https://api.lbkex.com/v2/ticker.do?symbol=",usdtSuffix:"usdt",intervalData:1e4,crptChos:"block",crncDsply:"none"},coincap:{name:"CoinCap",exchangeInfoUrl:"https://cors-anywhere.herokuapp.com/https://api.coincap.io/v2/assets",tickerPriceUrl:"https://api.coincap.io/v2/assets?symbol=bitcoin",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},kraken:{name:"Kraken",exchangeInfoUrl:"https://api.kraken.com/0/public/AssetPairs",tickerPriceUrl:"https://api.kraken.com/0/public/Ticker",usdtSuffix:"USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},coinbase:{name:"Coinbase",exchangeInfoUrl:"https://api.exchange.coinbase.com/products",tickerPriceUrl:"https://api.exchange.coinbase.com/products",usdtSuffix:"-USDT",intervalData:1e4,crptChos:"block",crncDsply:"none"},nasdaq:{name:"NASDAQ",exchangeInfoUrl:"https://proxyrequestv2-nkipfwe2qq-ew.a.run.app",tickerPriceUrl:"https://proxyrequestv2-nkipfwe2qq-ew.a.run.app",usdtSuffix:"USD",intervalData:36e5,crptChos:"none",crncDsply:"inline-block"}},exchs=["HKEX","LSE","NSE","SIX","XSWX","XPAR","XSHG","XSHE","XSES","nyse","nasdaq","gateIoSmbls","other"];exchs.forEach(e=>{EXCHANGES[e]={...EXCHANGES.nasdaq},EXCHANGES[e].name=e});const otherPrpos=["BMW.DE","XAUT-USD","XAGX-USD","CL=F","SI=F","HG=F","PL=F","PA=F"];let getPriceUrl="https://script.google.com/macros/s/AKfycbyg0QZ6udY-A2E8r_Q5rwr46HKUgFxV2h1MvKW1xJtYBBx2OJAmQo5zBM_fYsGhjvU6/exec";const FIREBASE_WEB_ALERT_URL="https://europe-west1-pricealert-31787.cloudfunctions.net/proxyRequestV2";let currencyFtch="USD",rfrsh=0;const MAX_ALERTS=50,exchangeSelect=gebi("exchangeSelect"),currentPriceDisplay=gebi("currentPrice"),targetPriceInput=gebi("targetPrice"),searchPrice=gebi("searchPrice"),dropdownList=gebi("dropdownList"),crncDsply=gebi("crncDsply"),alertTypeBrowserCheckbox=gebi("alertTypeBrowser"),alertTypeTelegramCheckbox=gebi("alertTypeTelegram"),telegramChatIdContainer=gebi("telegramChatIdContainer"),tlgChtIdInpt=gebi("telegramChatId"),setAlertButton=gebi("setAlertButton"),alertStatus=gebi("alertStatus");let telegramChatId,priceUpdateInterval,deferredPrompt,currentExchangeId=exchangeSelect.value,selectedSymbol="",currentPrice=null,factorPric=1,binanceSocket=null,binanceSocketSmbl=null,mexcSocket=null,mexcSocketSmbl=null,allCrpto=[],allPricesBns=[],allPricesMexc=[],alrtsStorg=JSON.parse(localStorage.getItem("alrtsStorg"))||[];document.addEventListener("DOMContentLoaded",()=>{startPage()}),document.addEventListener("click",function(e){document.querySelector(".dropdown-container").contains(e.target)||hideDropdown()}),crncDsply.addEventListener("change",async()=>{let e=1;const t=EXCHANGES.nasdaq.exchangeInfoUrl;if("USD"!==currencyFtch){const a=currencyFtch+"USD=X",r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"price",querySmble:a})}),c=await r.json();e=c.close||1}let a=1;const r=crncDsply.value;if("USD"!==r){const e=r+"USD=X",c=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"price",querySmble:e})}),n=await c.json();a=n.close||1}factorPric=e/a;const c=currentPrice*factorPric;currentPriceDisplay.textContent=c,targetPriceInput.value=c}),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,gebi("dvdw").style.display="block"});let buttonInstall=gebi("dvdw");buttonInstall.addEventListener("click",async()=>{gebi("dvdw").style.display="none",deferredPrompt.prompt(),deferredPrompt=null}),document.querySelectorAll(".crbtBtn").forEach(e=>{e.addEventListener("click",()=>{gebi("searchPrice").value=e.textContent,filterList()})});let UserImage=localStorage.base64Pctr||"/imgs/web/apple-touch-icon.png",accont="",enteEsc='<a  id="signOutLink" style="cursor:pointer" href="https://pricealerts.web.app/signin" >\n        \t\t\tØªØ³Ø¬Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„\n \t\t\t\t\t<img src="/imgs/web/signin-svgrepo-com.svg" alt="">\n\t\t\t\t</a> ';localStorage.base64Pctr&&(enteEsc="",accont=`<a id="accountLink" class="accountBtn" href="https://pricealerts.web.app/accont">\n\t\t\t\t${localStorage.userName||"Ø­Ø³Ø§Ø¨ÙŠ"}\n\t\t\t\t<img src="${UserImage}" alt="img" style="width: auto">\n\t\t\t </a>`);const sidebar=document.createElement("div");sidebar.className="sidebar",sidebar.innerHTML=`<!-- Sidebar (LEFT) -->\n\t\t\t<h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>\n\t\t\t<a href="https://pricealerts.web.app/">\n\t\t\t\tØ§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n\t\t\t\t<img src="/imgs/web/home-alt-1-svgrepo-com.svg" alt="home"></a>\n\t\t\t<a href="https://pricealerts.web.app/otherPage/about.html">\n\t\t\t\tÙ…Ù† Ù†Ø­Ù†\n            \t<img src="/imgs/web/info-circle-svgrepo-com.svg" alt="inf"></a>\n\n\t\t<!--\n        \t<a href="#">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>\n\t\t\t<a href="#">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a> \n             -->\n\t\t\t<a href="https://pricealerts.web.app/otherPage/privacy.html">\n           \t\tØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©\n\t\t\t\t<img src="/imgs/web/privacy-svgrepo-com.svg" alt=""></a>\n\t\t\t<a href="https://pricealerts.web.app/otherPage/contact.html">\n            Ø§ØªØµÙ„ Ø¨Ù†Ø§\n\t\t\t\t<img src="/imgs/web/mail-svgrepo-com.svg" alt="home"></a>\n\t\t\n        \t\t${enteEsc}\n\t\t\t\n\t\t\t${accont}\n`,document.body.prepend(sidebar);const navbar=document.createElement("nav");navbar.innerHTML=`\n\n<!-- Overlay -->\n\t\t<div id="overlay" class="overlay"></div>\n\n\t\t<!-- Navbar -->\n\t\t<div class="navbar">\n\t\t\t<a href="https://pricealerts.web.app" style= "height: 100%; display: flex; align-items: center;">\n\t\t\t\t<img id="imgNavbar" class="imgNavbar" src="${UserImage}" alt="">\n\t\t\t</a>\n\t\t\t<h1 class="hTitel">\n\t\t\t\tÙ…Ù†Ø¨Ù‡ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± \n\t\t\t</h1 >\n\t\t\t<div class="nav-title">\n                <button class="menu-btn" id="openSidebar">â˜°</button>\n\t\t\t</div>\n\t\t</div>\n\n\n`,document.querySelector(".pirantCntynr").prepend(navbar);const overlay=document.getElementById("overlay"),openBtn=document.getElementById("openSidebar");let gateSocket;openBtn.onclick=(()=>{sidebar.classList.add("open"),overlay.classList.add("show")}),overlay.onclick=(()=>{sidebar.classList.remove("open"),overlay.classList.remove("show")}),setAlertButton.addEventListener("click",async()=>{const e=alertTypeTelegramCheckbox.checked,t=alertTypeBrowserCheckbox.checked;if(!e&&!t)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚).",void(alertStatus.style.color="red");selectedSymbol=searchPrice.value;const a=parseFloat(targetPriceInput.value),r=document.querySelector('input[name="alertCondition"]:checked').value;if(telegramChatId=tlgChtIdInpt.value.trim(),isNaN(a)||a<=0)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ù…Ø³ØªÙ‡Ø¯Ù ØµØ­ÙŠØ­.",void(alertStatus.style.color="red");if(!selectedSymbol||!currentExchangeId)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØµØ© ÙˆØ¹Ù…Ù„Ø©.",void(alertStatus.style.color="red");if(e&&!telegramChatId)return alertStatus.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù‘Ù Ø¯Ø±Ø¯Ø´Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….",void(alertStatus.style.color="red");localStorage.setItem("exchangeChoz",currentExchangeId);const c={id:Date.now().toString(),e:currentExchangeId,s:selectedSymbol,tPrc:a,c:r,f:factorPric,isAlrd:!1,prc:null};if(t&&(c.alTp="b"),e){localStorage.idChat&&localStorage.idChat===telegramChatId||(localStorage.setItem("idChat",telegramChatId),await loadUserAlertsDisplay(),gebi("telegramChatIdNote").style.display="none"),c.tId=telegramChatId,c.alTp="t";const e=currentPriceDisplay.textContent;("l"===r&&e<=a||"g"===r&&e>=a)&&(c.isAlrd=!0,c.prc=e)}const n=await manageAlertOnFirebase("setAlert",c);n&&(alertStatus.textContent+=(e?" ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…":"")+(t?" ØªØ·Ø¨ÙŠÙ‚ ":"")+`ØªÙ… ØªØ¹ÙŠÙŠÙ† ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù€ ${selectedSymbol}.`,alertStatus.style.color="green")});